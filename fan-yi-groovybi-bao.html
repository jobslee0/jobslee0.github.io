<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ã€ç¿»è¯‘ã€‘Groovyé—­åŒ… - Z.H.</title><meta name="description" content="Groovyæ˜¯ä¸€é—¨åŸºäºJVMçš„è¯­è¨€ï¼Œå ªç§°åŠ¨æ€è¯­è¨€ç‰ˆJavaï¼Œå…¶å„ç§åŠ¨æ€è¯­è¨€ç‰¹æ€§å¡«è¡¥äº†Javaçš„å„ç§ç©ºç¼ºï¼Œè®©äººæ‹æ¡ˆå«ç»â€¦â€¦æœ‰å¹¸æ¥è§¦Groovyï¼Œé‚æ‰‹åŠ¨ç¿»è¯‘ä¸‰ç¯‡å®˜æ–¹æ–‡æ¡£ï¼Œä»¥ä¾¿äºè¯»è€…ä»Javaåˆ°Groovyçš„å¿«é€Ÿè¿ç§»ã€‚ æœ¬ç« èŠ‚ä¸»è¦è®²è§£Groovyçš„é—­åŒ…ã€‚Groovyä¸­çš„é—­åŒ…æ˜¯ä¸€ä¸ªå¼€æ”¾ã€åŒ¿åã€å¯ä»¥æºå¸¦å‚æ•°çš„ä»£ç å—ï¼ŒåŒæ—¶å¯ä»¥è¿”å›ä¸€ä¸ªæŒ‡å®šå˜é‡çš„å€¼ã€‚ä¸€ä¸ªé—­åŒ…å¯ä»¥å¼•ç”¨åœ¨å®ƒå‘¨å›´å£°æ˜çš„å˜é‡ã€‚ä¸é—­åŒ…çš„æ­£å¼å®šä¹‰ç›¸åçš„ï¼ŒClosureåœ¨Groovyè¯­è¨€ä¸­è¿˜å¯ä»¥åŒ…å«åœ¨å…¶å‘¨å›´èŒƒå›´ä¹‹å¤–å®šä¹‰çš„è‡ªç”±å˜é‡ã€‚è™½ç„¶æ‰“ç ´äº†é—­åŒ…çš„æ­£å¼æ¦‚å¿µï¼Œä½†å®ƒæä¾›äº†æœ¬ç« ä¸­æè¿°çš„å„ç§ä¼˜ç‚¹ã€‚ ä¸€ä¸ªé—­åŒ…çš„å®šä¹‰éµå¾ªä»¥ä¸‹è¯­æ³•ï¼š { [closureParameters -&gt;&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script type="text/javascript" async src="https://www.googletagmanager.com/gtag/js?id=6694651183"></script><script type="text/javascript">window.dataLayer = window.dataLayer || [];
				  function gtag(){dataLayer.push(arguments);}
				  gtag('js', new Date());
				  gtag('config', '6694651183' );
				  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NRGQEGZN7K"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NRGQEGZN7K');</script><link rel="canonical" href="https://jobslee0.github.io/fan-yi-groovybi-bao.html"><link rel="alternate" type="application/atom+xml" href="https://jobslee0.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://jobslee0.github.io/feed.json"><meta property="og:title" content="ã€ç¿»è¯‘ã€‘Groovyé—­åŒ…"><meta property="og:site_name" content="Z.H."><meta property="og:description" content="Groovyæ˜¯ä¸€é—¨åŸºäºJVMçš„è¯­è¨€ï¼Œå ªç§°åŠ¨æ€è¯­è¨€ç‰ˆJavaï¼Œå…¶å„ç§åŠ¨æ€è¯­è¨€ç‰¹æ€§å¡«è¡¥äº†Javaçš„å„ç§ç©ºç¼ºï¼Œè®©äººæ‹æ¡ˆå«ç»â€¦â€¦æœ‰å¹¸æ¥è§¦Groovyï¼Œé‚æ‰‹åŠ¨ç¿»è¯‘ä¸‰ç¯‡å®˜æ–¹æ–‡æ¡£ï¼Œä»¥ä¾¿äºè¯»è€…ä»Javaåˆ°Groovyçš„å¿«é€Ÿè¿ç§»ã€‚ æœ¬ç« èŠ‚ä¸»è¦è®²è§£Groovyçš„é—­åŒ…ã€‚Groovyä¸­çš„é—­åŒ…æ˜¯ä¸€ä¸ªå¼€æ”¾ã€åŒ¿åã€å¯ä»¥æºå¸¦å‚æ•°çš„ä»£ç å—ï¼ŒåŒæ—¶å¯ä»¥è¿”å›ä¸€ä¸ªæŒ‡å®šå˜é‡çš„å€¼ã€‚ä¸€ä¸ªé—­åŒ…å¯ä»¥å¼•ç”¨åœ¨å®ƒå‘¨å›´å£°æ˜çš„å˜é‡ã€‚ä¸é—­åŒ…çš„æ­£å¼å®šä¹‰ç›¸åçš„ï¼ŒClosureåœ¨Groovyè¯­è¨€ä¸­è¿˜å¯ä»¥åŒ…å«åœ¨å…¶å‘¨å›´èŒƒå›´ä¹‹å¤–å®šä¹‰çš„è‡ªç”±å˜é‡ã€‚è™½ç„¶æ‰“ç ´äº†é—­åŒ…çš„æ­£å¼æ¦‚å¿µï¼Œä½†å®ƒæä¾›äº†æœ¬ç« ä¸­æè¿°çš„å„ç§ä¼˜ç‚¹ã€‚ ä¸€ä¸ªé—­åŒ…çš„å®šä¹‰éµå¾ªä»¥ä¸‹è¯­æ³•ï¼š { [closureParameters -&gt;&hellip;"><meta property="og:url" content="https://jobslee0.github.io/fan-yi-groovybi-bao.html"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://jobslee0.github.io/media/website/photo2pixel_download-2.png" type="image/x-icon"><link rel="preload" href="https://jobslee0.github.io/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://jobslee0.github.io/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://jobslee0.github.io/assets/css/style.css?v=82007ae11cb9f2a56571c770331b13e7"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://jobslee0.github.io/fan-yi-groovybi-bao.html"},"headline":"ã€ç¿»è¯‘ã€‘Groovyé—­åŒ…","datePublished":"2023-01-09T15:45","dateModified":"2024-09-27T20:51","description":"Groovyæ˜¯ä¸€é—¨åŸºäºJVMçš„è¯­è¨€ï¼Œå ªç§°åŠ¨æ€è¯­è¨€ç‰ˆJavaï¼Œå…¶å„ç§åŠ¨æ€è¯­è¨€ç‰¹æ€§å¡«è¡¥äº†Javaçš„å„ç§ç©ºç¼ºï¼Œè®©äººæ‹æ¡ˆå«ç»â€¦â€¦æœ‰å¹¸æ¥è§¦Groovyï¼Œé‚æ‰‹åŠ¨ç¿»è¯‘ä¸‰ç¯‡å®˜æ–¹æ–‡æ¡£ï¼Œä»¥ä¾¿äºè¯»è€…ä»Javaåˆ°Groovyçš„å¿«é€Ÿè¿ç§»ã€‚ æœ¬ç« èŠ‚ä¸»è¦è®²è§£Groovyçš„é—­åŒ…ã€‚Groovyä¸­çš„é—­åŒ…æ˜¯ä¸€ä¸ªå¼€æ”¾ã€åŒ¿åã€å¯ä»¥æºå¸¦å‚æ•°çš„ä»£ç å—ï¼ŒåŒæ—¶å¯ä»¥è¿”å›ä¸€ä¸ªæŒ‡å®šå˜é‡çš„å€¼ã€‚ä¸€ä¸ªé—­åŒ…å¯ä»¥å¼•ç”¨åœ¨å®ƒå‘¨å›´å£°æ˜çš„å˜é‡ã€‚ä¸é—­åŒ…çš„æ­£å¼å®šä¹‰ç›¸åçš„ï¼ŒClosureåœ¨Groovyè¯­è¨€ä¸­è¿˜å¯ä»¥åŒ…å«åœ¨å…¶å‘¨å›´èŒƒå›´ä¹‹å¤–å®šä¹‰çš„è‡ªç”±å˜é‡ã€‚è™½ç„¶æ‰“ç ´äº†é—­åŒ…çš„æ­£å¼æ¦‚å¿µï¼Œä½†å®ƒæä¾›äº†æœ¬ç« ä¸­æè¿°çš„å„ç§ä¼˜ç‚¹ã€‚ ä¸€ä¸ªé—­åŒ…çš„å®šä¹‰éµå¾ªä»¥ä¸‹è¯­æ³•ï¼š { [closureParameters -&gt;&hellip;","author":{"@type":"Person","name":"Jobs.Lee","url":"https://jobslee0.github.io/authors/jobslee/"},"publisher":{"@type":"Organization","name":"Jobs.Lee"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><div class="container container--center"><header class="header"><div class="header__logo"><a class="logo" href="https://jobslee0.github.io/">Z.H.</a></div></header><main class="content"><article class="post"><header><h1 class="post__title">ã€ç¿»è¯‘ã€‘Groovyé—­åŒ…</h1><div class="post__meta"><time datetime="2023-01-09T15:45" class="post__date">ä¸€æœˆ 9, 2023 </time><span class="post__author"><a href="https://jobslee0.github.io/authors/jobslee/" class="feed__author">Jobs.Lee</a></span></div><div class="post__tags"><a href="https://jobslee0.github.io/tags/groovy/" class="invert">Groovy</a> <a href="https://jobslee0.github.io/tags/java/" class="invert">Java</a> <a href="https://jobslee0.github.io/tags/fan-yi/" class="invert">ç¿»è¯‘</a></div></header><div class="post__entry"><p>Groovyæ˜¯ä¸€é—¨åŸºäºJVMçš„è¯­è¨€ï¼Œå ªç§°åŠ¨æ€è¯­è¨€ç‰ˆJavaï¼Œå…¶å„ç§åŠ¨æ€è¯­è¨€ç‰¹æ€§å¡«è¡¥äº†Javaçš„å„ç§ç©ºç¼ºï¼Œè®©äººæ‹æ¡ˆå«ç»â€¦â€¦æœ‰å¹¸æ¥è§¦Groovyï¼Œé‚æ‰‹åŠ¨ç¿»è¯‘ä¸‰ç¯‡å®˜æ–¹æ–‡æ¡£ï¼Œä»¥ä¾¿äºè¯»è€…ä»Javaåˆ°Groovyçš„å¿«é€Ÿè¿ç§»ã€‚</p><hr><h1 id="é—­åŒ…">é—­åŒ…</h1><p>æœ¬ç« èŠ‚ä¸»è¦è®²è§£Groovyçš„é—­åŒ…ã€‚Groovyä¸­çš„é—­åŒ…æ˜¯ä¸€ä¸ªå¼€æ”¾ã€åŒ¿åã€å¯ä»¥æºå¸¦å‚æ•°çš„ä»£ç å—ï¼ŒåŒæ—¶å¯ä»¥è¿”å›ä¸€ä¸ªæŒ‡å®šå˜é‡çš„å€¼ã€‚ä¸€ä¸ªé—­åŒ…å¯ä»¥å¼•ç”¨åœ¨å®ƒå‘¨å›´å£°æ˜çš„å˜é‡ã€‚ä¸é—­åŒ…çš„æ­£å¼å®šä¹‰ç›¸åçš„ï¼Œ<code>Closure</code>åœ¨Groovyè¯­è¨€ä¸­è¿˜å¯ä»¥åŒ…å«åœ¨å…¶å‘¨å›´èŒƒå›´ä¹‹å¤–å®šä¹‰çš„è‡ªç”±å˜é‡ã€‚è™½ç„¶æ‰“ç ´äº†é—­åŒ…çš„æ­£å¼æ¦‚å¿µï¼Œä½†å®ƒæä¾›äº†æœ¬ç« ä¸­æè¿°çš„å„ç§ä¼˜ç‚¹ã€‚</p><h2 id="1-è¯­æ³•">1. è¯­æ³•</h2><h3 id="11-å®šä¹‰ä¸€ä¸ªé—­åŒ…">1.1. å®šä¹‰ä¸€ä¸ªé—­åŒ…</h3><p>ä¸€ä¸ªé—­åŒ…çš„å®šä¹‰éµå¾ªä»¥ä¸‹è¯­æ³•ï¼š</p><pre><code class="language-Groovy">{ [closureParameters -&gt; ] statements }
</code></pre><p><code>[closureParameters-&gt;]</code>æ˜¯ä¸€ä¸ªå¯é€‰çš„é€—å·åˆ†éš”çš„å‚æ•°åˆ—è¡¨ï¼Œè¯­å¥æ˜¯0ä¸ªæˆ–è€…å¤šä¸ªGroovyè¯­å¥ã€‚è¿™äº›å‚æ•°çœ‹èµ·æ¥åƒæ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼Œè¿™äº›å‚æ•°ç±»å‹å¯æœ‰å¯æ— ã€‚</p><p>å½“ä¸€ä¸ªå‚æ•°åˆ—è¡¨è¢«æŒ‡å®šï¼Œ<code>-&gt;</code>ç¬¦å·æ˜¯å¿…é¡»çš„ï¼Œå®ƒèƒ½å¤Ÿåœ¨é—­åŒ…ä½“ä¸­æä¾›åˆ†å‰²å‚æ•°çš„åŠŸèƒ½ã€‚<em>è¯­å¥</em>éƒ¨åˆ†ç”±0ä¸ªã€1ä¸ªæˆ–è€…è®¸å¤šä¸ªGroovyè¯­å¥ç»„æˆã€‚</p><p>ä¸€äº›æœ‰æ•ˆçš„é—­åŒ…å®šä¹‰ç¤ºä¾‹ï¼š</p><pre><code class="language-Groovy">{ item++ }                                          (1)
{ -&gt; item++ }                                       (2)
{ println it }                                      (3)
{ it -&gt; println it }                                (4)
{ name -&gt; println name }                            (5)
{ String x, int y -&gt;                                (6)
    println &quot;hey ${x} the value is ${y}&quot;
}{ reader -&gt;                                         (7)
    def line = reader.readLine()
    line.trim()
}
</code></pre><table><thead><tr><th><strong>1</strong></th><th>å¼•ç”¨åä¸º<code>item</code>çš„å˜é‡çš„é—­åŒ…</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>å¯ä»¥é€šè¿‡æ·»åŠ ç®­å¤´ (<code>-&gt;</code>) å°†é—­åŒ…å‚æ•°ä¸ä»£ç æ˜¾å¼åˆ†å¼€</td></tr><tr><td><strong>3</strong></td><td>ä½¿ç”¨éšå¼å‚æ•° (<code>it</code>) çš„é—­åŒ…</td></tr><tr><td><strong>4</strong></td><td><code>it</code>æ˜¯æ˜¾å¼å‚æ•°çš„æ›¿ä»£ç‰ˆæœ¬</td></tr><tr><td><strong>5</strong></td><td>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šå¸¸æœ€å¥½ä¸ºå‚æ•°ä½¿ç”¨æ˜¾å¼åç§°</td></tr><tr><td><strong>6</strong></td><td>ä¸€ä¸ªæ¥å—ä¸¤ä¸ªç±»å‹å‚æ•°çš„é—­åŒ…</td></tr><tr><td><strong>7</strong></td><td>ä¸€ä¸ªé—­åŒ…å¯ä»¥åŒ…å«å¤šä¸ªè¯­å¥</td></tr></tbody></table><h3 id="12-é—­åŒ…æ˜¯ä¸€ä¸ªå¯¹è±¡">1.2. é—­åŒ…æ˜¯ä¸€ä¸ªå¯¹è±¡</h3><p>é—­åŒ…æ˜¯<code>groovy.lang.Closure</code>ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œä½¿å®ƒå¯ä»¥åƒä»»ä½•å…¶ä»–å˜é‡ä¸€æ ·åˆ†é…ç»™å˜é‡æˆ–å­—æ®µï¼Œå°½ç®¡å®ƒæ˜¯ä¸€ä¸ªä»£ç å—ï¼š</p><pre><code class="language-Groovy">def listener = { e -&gt; println &quot;Clicked on $e.source&quot; }      (1)
assert listener instanceof Closure
Closure callback = { println &#39;Done!&#39; }                      (2)
Closure&lt;Boolean&gt; isTextFile = {
    File it -&gt; it.name.endsWith(&#39;.txt&#39;)                     (3)
}
</code></pre><table><thead><tr><th><strong>1</strong></th><th>ä½ å¯ä»¥å°†é—­åŒ…åˆ†é…ç»™å˜é‡ï¼Œå®ƒæ˜¯<code>groovy.lang.Closure</code>çš„ä¸€ä¸ªå®ä¾‹</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>å¦‚æœä¸ä½¿ç”¨<code>def</code>æˆ–<code>var</code>ï¼Œè¯·ä½¿ç”¨<code>groovy.lang.Closure</code>ä½œä¸ºç±»å‹</td></tr><tr><td><strong>3</strong></td><td>æˆ–è€…ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>groovy.lang.Closure</code>çš„æ³›å‹ç±»å‹æŒ‡å®šé—­åŒ…çš„è¿”å›ç±»å‹</td></tr></tbody></table><h3 id="13-è°ƒç”¨ä¸€ä¸ªé—­åŒ…">1.3. è°ƒç”¨ä¸€ä¸ªé—­åŒ…</h3><p>ä¸€ä¸ªé—­åŒ…ï¼Œä½œä¸ºä¸€ä¸ªåŒ¿åçš„ä»£ç å—ï¼Œå¯ä»¥åƒå…¶ä»–ä»»ä½•æ–¹æ³•ä¸€æ ·è¢«è°ƒç”¨ã€‚å¦‚æœä½ å®šä¹‰ä¸€ä¸ªä¸å¸¦ä»»ä½•å‚æ•°çš„é—­åŒ…ï¼Œåƒè¿™æ ·ï¼š</p><pre><code class="language-Groovy">def code = { 123 }
</code></pre><p>é—­åŒ…ä¸­çš„ä»£ç åªæœ‰å½“ä½ <em>è°ƒç”¨</em>çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œï¼Œè¿™å¯ä»¥ä½¿ç”¨å˜é‡æ¥å®ç°ï¼Œå°±åƒå®ƒæ˜¯ä¸€ä¸ªå¸¸è§„æ–¹æ³•ä¸€æ ·ï¼š</p><pre><code class="language-Groovy">assert code() == 123
</code></pre><p>æˆ–è€…ï¼Œä½ å¯ä»¥æ˜¾å¼åœ°ä½¿ç”¨<code>call</code>æ–¹æ³•ï¼š</p><pre><code class="language-Groovy">assert code.call() == 123
</code></pre><p>å¦‚æœé—­åŒ…æ¥å—å‚æ•°ï¼ŒåŸåˆ™æ˜¯ä¸€æ ·çš„ï¼š</p><pre><code class="language-Groovy">def isOdd = { int i -&gt; i%2 != 0 }                           (1)
assert isOdd(3) == true                                     (2)
assert isOdd.call(2) == false                               (3)
def isEven = { it%2 == 0 }                                  (4)
assert isEven(3) == false                                   (5)
assert isEven.call(2) == true                               (6)
</code></pre><table><thead><tr><th><strong>1</strong></th><th>å®šä¹‰ä¸€ä¸ªæ¥å—<code>int</code>ä½œä¸ºå‚æ•°çš„é—­åŒ…</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>å¯ä»¥ç›´æ¥è°ƒç”¨</td></tr><tr><td><strong>3</strong></td><td>æˆ–è€…ä½¿ç”¨<code>call</code>æ–¹æ³•</td></tr><tr><td><strong>4</strong></td><td>å¸¦æœ‰éšå¼å‚æ•°ï¼ˆ<code>it</code>ï¼‰çš„é—­åŒ…ä¹Ÿæ˜¯å¦‚æ­¤</td></tr><tr><td><strong>5</strong></td><td>å¯ä»¥ä½¿ç”¨ (<code>arg</code>) ç›´æ¥è°ƒç”¨</td></tr><tr><td><strong>6</strong></td><td>æˆ–ä½¿ç”¨<code>call</code></td></tr></tbody></table><p>ä¸æ–¹æ³•ä¸åŒï¼Œé—­åŒ…åœ¨è°ƒç”¨æ—¶<strong>æ€»æ˜¯</strong>è¿”å›ä¸€ä¸ªå€¼ã€‚ä¸‹ä¸€èŠ‚è®¨è®ºå¦‚ä½•å£°æ˜é—­åŒ…å‚æ•°ï¼Œä½•æ—¶ä½¿ç”¨å®ƒä»¬ä»¥åŠä»€ä¹ˆæ˜¯éšå¼â€œitâ€å‚æ•°ã€‚</p><h2 id="2-å‚æ•°">2. å‚æ•°</h2><h3 id="21-æ­£å¸¸å‚æ•°">2.1. æ­£å¸¸å‚æ•°</h3><p>é—­åŒ…çš„å‚æ•°éµå¾ªä¸å¸¸è§„æ–¹æ³•çš„å‚æ•°ç›¸åŒçš„åŸåˆ™ï¼š</p><ul><li>å¯é€‰ç±»å‹</li><li>ä¸€ä¸ªåå­—</li><li>å¯é€‰çš„é»˜è®¤å€¼</li></ul><p>å‚æ•°ç”¨é€—å·åˆ†éš”ï¼š</p><pre><code class="language-Groovy">def closureWithOneArg = { str -&gt; str.toUpperCase() }
assert closureWithOneArg(&#39;groovy&#39;) == &#39;GROOVY&#39;def closureWithOneArgAndExplicitType = { String str -&gt; str.toUpperCase() }
assert closureWithOneArgAndExplicitType(&#39;groovy&#39;) == &#39;GROOVY&#39;def closureWithTwoArgs = { a,b -&gt; a+b }
assert closureWithTwoArgs(1,2) == 3def closureWithTwoArgsAndExplicitTypes = { int a, int b -&gt; a+b }
assert closureWithTwoArgsAndExplicitTypes(1,2) == 3def closureWithTwoArgsAndOptionalTypes = { a, int b -&gt; a+b }
assert closureWithTwoArgsAndOptionalTypes(1,2) == 3def closureWithTwoArgAndDefaultValue = { int a, int b=2 -&gt; a+b }
assert closureWithTwoArgAndDefaultValue(1) == 3
</code></pre><h3 id="22-éšå¼å‚æ•°">2.2. éšå¼å‚æ•°</h3><p>å½“ä¸€ä¸ªé—­åŒ…æ²¡æœ‰æ˜¾ç¤ºçš„å£°æ˜å‚æ•°åˆ—è¡¨ï¼ˆä½¿ç”¨<code>-&gt;</code>ï¼‰ï¼Œä¸€ä¸ªé—­åŒ…<strong>æ€»æ˜¯</strong>å®šä¹‰äº†ä¸€ä¸ªéšå¼çš„å‚æ•°ï¼Œå«åš<code>it</code>ã€‚è¿™æ„å‘³ç€ä»¥ä¸‹ä»£ç ï¼š</p><pre><code class="language-Groovy">def greeting = { &quot;Hello, $it!&quot; }
assert greeting(&#39;Patrick&#39;) == &#39;Hello, Patrick!&#39;
</code></pre><p>ä¸¥æ ¼ç­‰åŒäºè¿™ä¸ªï¼š</p><pre><code class="language-Groovy">def greeting = { it -&gt; &quot;Hello, $it!&quot; }
assert greeting(&#39;Patrick&#39;) == &#39;Hello, Patrick!&#39;
</code></pre><p>å¦‚æœä½ æƒ³å£°æ˜ä¸€ä¸ªä¸æ¥å—å‚æ•°å¹¶ä¸”å¿…é¡»é™åˆ¶ä¸ºä¸å¸¦å‚æ•°è°ƒç”¨çš„é—­åŒ…ï¼Œé‚£ä¹ˆä½ <strong>å¿…é¡»</strong>ç”¨ä¸€ä¸ªæ˜¾å¼çš„ç©ºå‚æ•°åˆ—è¡¨å£°æ˜å®ƒï¼š</p><pre><code class="language-Groovy">def magicNumber = { -&gt; 42 }// this call will fail because the closure doesn&#39;t accept any argument
magicNumber(11)
</code></pre><h3 id="23-varargs">2.3. Varargs</h3><p>é—­åŒ…å¯ä»¥åƒä»»ä½•å…¶ä»–æ–¹æ³•ä¸€æ ·å£°æ˜å˜é‡å‚æ•°ã€‚å¦‚æœæœ€åä¸€ä¸ªå‚æ•°æ˜¯å¯å˜é•¿åº¦ï¼ˆæˆ–æ•°ç»„ï¼‰ï¼Œåˆ™<em>Vargs</em>æ–¹æ³•æ˜¯å¯ä»¥æ¥å—å¯å˜æ•°é‡å‚æ•°çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><pre><code class="language-Groovy">def concat1 = { String... args -&gt; args.join(&#39;&#39;) }           (1)
assert concat1(&#39;abc&#39;,&#39;def&#39;) == &#39;abcdef&#39;                     (2)
def concat2 = { String[] args -&gt; args.join(&#39;&#39;) }            (3)
assert concat2(&#39;abc&#39;, &#39;def&#39;) == &#39;abcdef&#39;def multiConcat = { int n, String... args -&gt;                (4)
    args.join(&#39;&#39;)*n
}
assert multiConcat(2, &#39;abc&#39;,&#39;def&#39;) == &#39;abcdefabcdef&#39;
</code></pre><table><thead><tr><th><strong>1</strong></th><th>æ¥å—å¯å˜æ•°é‡çš„å­—ç¬¦ä¸²ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°çš„é—­åŒ…</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>å¯ä»¥ä½¿ç”¨ä»»æ„æ•°é‡çš„å‚æ•°è°ƒç”¨å®ƒï¼Œè€Œ<strong>æ— éœ€</strong>å°†å®ƒä»¬æ˜¾å¼åŒ…è£…åˆ°æ•°ç»„ä¸­</td></tr><tr><td><strong>3</strong></td><td>å¦‚æœå°†<em>args</em>å‚æ•°å£°æ˜ä¸ºæ•°ç»„ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ç›¸åŒçš„è¡Œä¸º</td></tr><tr><td><strong>4</strong></td><td>åªè¦<strong>æœ€å</strong>ä¸€ä¸ªå‚æ•°æ˜¯æ•°ç»„æˆ–æ˜¾å¼ vargs ç±»å‹</td></tr></tbody></table><h2 id="3-å§”æ‰˜ç­–ç•¥">3. å§”æ‰˜ç­–ç•¥</h2><h3 id="31-groovyé—­åŒ…-vs-lambdaè¡¨è¾¾å¼">3.1. Groovyé—­åŒ… vs lambdaè¡¨è¾¾å¼</h3><p>Groovyå°†é—­åŒ…å®šä¹‰ä¸ºClosureç±»çš„å®ä¾‹ã€‚è¿™ä½¿å¾—å®ƒè·Ÿ<a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">lambda expressions in Java 8</a>éå¸¸çš„ä¸ä¸€æ ·ã€‚å§”æ‰˜åœ¨Groovyé—­åŒ…ä¸­æ˜¯ä¸€ä¸ªè·Ÿlambdaä¸ç›¸åŒçš„é‡è¦æ¦‚å¿µã€‚<em>æ›´æ”¹å§”æ‰˜</em>æˆ–<em>æ›´æ”¹é—­åŒ…çš„å§”æ‰˜ç­–ç•¥</em>çš„èƒ½åŠ›ä½¿å¾—åœ¨ Groovy ä¸­è®¾è®¡æ¼‚äº®çš„é¢†åŸŸç‰¹å®šè¯­è¨€ (DSL) æˆä¸ºå¯èƒ½ã€‚</p><h3 id="32-owner-delegateå’Œthis">3.2. Owner, delegateå’Œthis</h3><p>ä¸ºäº†ç†è§£delegateçš„æ¦‚å¿µï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»è§£é‡Šä¸‹é—­åŒ…ä¸­<code>this</code>çš„å«ä¹‰ã€‚ä¸€ä¸ªé—­åŒ…å®é™…ä¸Šå®šä¹‰äº†3ä¸ªä¸åŒçš„ä¸œè¥¿ï¼š</p><ul><li><code>this</code>å¯¹åº”äºå®šä¹‰é—­åŒ…çš„<em>å°é—­ç±»</em></li><li><code>owner</code>å¯¹åº”äºå®šä¹‰é—­åŒ…çš„<em>å°é—­å¯¹è±¡</em>ï¼Œå¯ä»¥æ˜¯ç±»ä¹Ÿå¯ä»¥æ˜¯é—­åŒ…</li><li><code>delegate</code>å¯¹åº”äºç¬¬ä¸‰æ–¹å¯¹è±¡ï¼Œåªè¦æœªå®šä¹‰æ¶ˆæ¯çš„æ¥æ”¶è€…ï¼Œå°±ä¼šè§£ææ–¹æ³•è°ƒç”¨æˆ–å±æ€§</li></ul><h4 id="321-thisçš„å«ä¹‰">3.2.1. thisçš„å«ä¹‰</h4><p>åœ¨é—­åŒ…ä¸­ï¼Œè°ƒç”¨<code>getThisObject</code>å°†ä¼šè¿”å›é—­åŒ…å®šä¹‰çš„å°é—­ç±»ã€‚å®ƒç­‰æ•ˆäºä½¿ç”¨æ˜¾å¼<code>this</code>ï¼š</p><pre><code class="language-Groovy">class Enclosing {
    void run() {
        def whatIsThisObject = { getThisObject() }          (1)
        assert whatIsThisObject() == this                   (2)
        def whatIsThis = { this }                           (3)
        assert whatIsThis() == this                         (4)
    }
}
class EnclosedInInnerClass {
    class Inner {
        Closure cl = { this }                               (5)
    }
    void run() {
        def inner = new Inner()
        assert inner.cl() == inner                          (6)
    }
}
class NestedClosures {
    void run() {
        def nestedClosures = {
            def cl = { this }                               (7)
            cl()
        }
        assert nestedClosures() == this                     (8)
    }
}
</code></pre><table><thead><tr><th><strong>1</strong></th><th>åœ¨<code>Enclosure</code>ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªé—­åŒ…ï¼Œå¹¶è¿”å›<code>getThisObject</code></th></tr></thead><tbody><tr><td><strong>2</strong></td><td>è°ƒç”¨é—­åŒ…å°†è¿”å›å®šä¹‰é—­åŒ…çš„<code>Enclosure</code>å®ä¾‹</td></tr><tr><td><strong>3</strong></td><td>é€šå¸¸ï¼Œä½ åªæƒ³ä½¿ç”¨<code>this</code>è¡¨ç¤ºæ³•çš„å¿«æ·æ–¹å¼</td></tr><tr><td><strong>4</strong></td><td>å®ƒè¿”å›<strong>å®Œå…¨</strong>ç›¸åŒçš„å¯¹è±¡</td></tr><tr><td><strong>5</strong></td><td>å¦‚æœé—­åŒ…æ˜¯åœ¨å†…éƒ¨ç±»ä¸­å®šä¹‰çš„</td></tr><tr><td><strong>6</strong></td><td>é—­åŒ…ä¸­çš„<code>this</code>â€‹<strong>å°†</strong>è¿”å›å†…éƒ¨ç±»ï¼Œè€Œä¸æ˜¯é¡¶çº§ç±»</td></tr><tr><td><strong>7</strong></td><td>åœ¨åµŒå¥—é—­åŒ…çš„æƒ…å†µä¸‹ï¼Œå°±åƒè¿™é‡Œ<code>cl</code>è¢«å®šä¹‰åœ¨<code>NestedClosures</code>çš„èŒƒå›´å†…</td></tr><tr><td><strong>8</strong></td><td>é‚£ä¹ˆ<code>this</code>å¯¹åº”äºæœ€è¿‘çš„å¤–éƒ¨ç±»ï¼Œè€Œä¸æ˜¯å°é—­çš„é—­åŒ…ï¼</td></tr></tbody></table><p>å½“ç„¶å¯ä»¥è¿™æ ·è°ƒç”¨é—­åŒ…ç±»ä¸­çš„æ–¹æ³•ï¼š</p><pre><code class="language-Groovy">class Person {
    String name
    int age
    String toString() { &quot;$name is $age years old&quot; }

    String dump() {
        def cl = {
            String msg = this.toString()               (1)
            println msg
            msg
        }
        cl()
    }
}
def p = new Person(name:&#39;Janice&#39;, age:74)
assert p.dump() == &#39;Janice is 74 years old&#39;
</code></pre><table><thead><tr><th><strong>1</strong></th><th>é—­åŒ…åœ¨<code>this</code>ä¸Šè°ƒç”¨<code>toString</code>ï¼Œè¿™å®é™…ä¸Šä¼šåœ¨å°é—­å¯¹è±¡ä¸Šè°ƒç”¨<code>toString</code>æ–¹æ³•ï¼Œå³<code>Person</code>å®ä¾‹</th></tr></thead></table><h4 id="322-é—­åŒ…çš„æ‰€æœ‰è€…owner">3.2.2. é—­åŒ…çš„æ‰€æœ‰è€…Owner</h4><p>é—­åŒ…çš„ownerä¸é—­åŒ…ä¸­thisçš„å®šä¹‰éå¸¸ç›¸ä¼¼ï¼Œä½†æœ‰ç»†å¾®å·®åˆ«ï¼šå®ƒå°†è¿”å›ç›´æ¥å°é—­çš„å¯¹è±¡ï¼Œæ— è®ºæ˜¯é—­åŒ…è¿˜æ˜¯ç±»ï¼š</p><pre><code class="language-Groovy">class Enclosing {
    void run() {
        def whatIsOwnerMethod = { getOwner() }               (1)
        assert whatIsOwnerMethod() == this                   (2)
        def whatIsOwner = { owner }                          (3)
        assert whatIsOwner() == this                         (4)
    }
}
class EnclosedInInnerClass {
    class Inner {
        Closure cl = { owner }                               (5)
    }
    void run() {
        def inner = new Inner()
        assert inner.cl() == inner                           (6)
    }
}
class NestedClosures {
    void run() {
        def nestedClosures = {
            def cl = { owner }                               (7)
            cl()
        }
        assert nestedClosures() == nestedClosures            (8)
    }
}
</code></pre><table><thead><tr><th><strong>1</strong></th><th>åœ¨<code>Enclosure</code>ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªé—­åŒ…ï¼Œå¹¶è¿”å›<code>getOwner</code></th></tr></thead><tbody><tr><td><strong>2</strong></td><td>è°ƒç”¨é—­åŒ…å°†è¿”å›å®šä¹‰é—­åŒ…çš„<code>Enclosure</code>å®ä¾‹</td></tr><tr><td><strong>3</strong></td><td>é€šå¸¸ï¼Œä½ åªæƒ³ä½¿ç”¨å¿«æ·æ–¹å¼<code>owener</code>è¡¨ç¤ºæ³•</td></tr><tr><td><strong>4</strong></td><td>å®ƒè¿”å›<strong>å®Œå…¨</strong>ç›¸åŒçš„å¯¹è±¡</td></tr><tr><td><strong>5</strong></td><td>å¦‚æœé—­åŒ…æ˜¯åœ¨å†…éƒ¨ç±»ä¸­å®šä¹‰çš„</td></tr><tr><td><strong>6</strong></td><td>é—­åŒ…ä¸­çš„<code>owener</code>â€‹<strong>å°†</strong>è¿”å›å†…éƒ¨ç±»ï¼Œè€Œä¸æ˜¯é¡¶çº§ç±»</td></tr><tr><td><strong>7</strong></td><td>ä½†æ˜¯åœ¨<code>nestedClosures</code>çš„æƒ…å†µä¸‹ï¼Œå°±åƒè¿™é‡Œ<code>cl</code>è¢«å®šä¹‰åœ¨åµŒå¥—é—­åŒ…çš„èŒƒå›´å†…</td></tr><tr><td><strong>8</strong></td><td>é‚£ä¹ˆ<code>owner</code>å¯¹åº”äºå°é—­çš„é—­åŒ…ï¼Œå› æ­¤ä¸<code>this</code>ä¸åŒçš„å¯¹è±¡ï¼</td></tr></tbody></table><h4 id="323-é—­åŒ…çš„å§”æ‰˜delegate">3.2.3. é—­åŒ…çš„å§”æ‰˜Delegate</h4><p>å¯ä»¥ä½¿ç”¨å§”æ‰˜å±æ€§æˆ–è°ƒç”¨<code>getDelegate</code>æ–¹æ³•æ¥è®¿é—®é—­åŒ…çš„å§”æ‰˜ã€‚å®ƒæ˜¯åœ¨ Groovy ä¸­æ„å»ºç‰¹å®šé¢†åŸŸè¯­è¨€çš„å¼ºå¤§æ¦‚å¿µã€‚è™½ç„¶thiså’ŒowneræŒ‡çš„æ˜¯é—­åŒ…çš„è¯æ³•èŒƒå›´ï¼Œä½†å§”æ‰˜æ˜¯é—­åŒ…å°†ä½¿ç”¨çš„ç”¨æˆ·å®šä¹‰å¯¹è±¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå§”æ‰˜è®¾ç½®ä¸º<code>owener</code>ï¼š</p><pre><code class="language-Groovy">class Enclosing {
    void run() {
        def cl = { getDelegate() }                          (1)
        def cl2 = { delegate }                              (2)
        assert cl() == cl2()                                (3)
        assert cl() == this                                 (4)
        def enclosed = {
            { -&gt; delegate }.call()                          (5)
        }
        assert enclosed() == enclosed                       (6)
    }
}
</code></pre><table><thead><tr><th><strong>1</strong></th><th>ä½ å¯ä»¥é€šè¿‡è°ƒç”¨<code>getDelegate</code>æ–¹æ³•è·å–é—­åŒ…çš„å§”æ‰˜</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>æˆ–ä½¿ç”¨<code>delegate</code>å±æ€§</td></tr><tr><td><strong>3</strong></td><td>ä¸¤è€…éƒ½è¿”å›ç›¸åŒçš„å¯¹è±¡</td></tr><tr><td><strong>4</strong></td><td>è¿™æ˜¯å°é—­ç±»æˆ–é—­åŒ…</td></tr><tr><td><strong>5</strong></td><td>ç‰¹åˆ«æ˜¯åœ¨åµŒå¥—é—­åŒ…çš„æƒ…å†µä¸‹</td></tr><tr><td><strong>6</strong></td><td><code>delegate</code>å°†å¯¹åº”äº<code>owner</code></td></tr></tbody></table><p>é—­åŒ…çš„å§”æ‰˜å¯ä»¥æ›´æ”¹ä¸º<strong>ä»»ä½•å¯¹è±¡</strong>ã€‚è®©æˆ‘ä»¬é€šè¿‡åˆ›å»ºä¸¤ä¸ªç±»æ¥è¯´æ˜è¿™ä¸€ç‚¹ï¼Œå®ƒä»¬ä¸æ˜¯å½¼æ­¤çš„å­ç±»ï¼Œä½†éƒ½å®šä¹‰äº†ä¸€ä¸ªåä¸º<code>name</code>çš„å±æ€§ï¼š</p><pre><code class="language-Groovy">class Person {
    String name
}
class Thing {
    String name
}def p = new Person(name: &#39;Norman&#39;)
def t = new Thing(name: &#39;Teapot&#39;)
</code></pre><p>ç„¶åè®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªé—­åŒ…æ¥è·å–å§”æ‰˜ä¸Šçš„<code>name</code>å±æ€§ï¼š</p><pre><code class="language-Groovy">def upperCasedName = { delegate.name.toUpperCase() }
</code></pre><p>ç„¶åé€šè¿‡æ›´æ”¹é—­åŒ…çš„å§”æ‰˜ï¼Œå¯ä»¥çœ‹åˆ°ç›®æ ‡å¯¹è±¡ä¼šå‘ç”Ÿå˜åŒ–ï¼š</p><pre><code class="language-Groovy">upperCasedName.delegate = p
assert upperCasedName() == &#39;NORMAN&#39;
upperCasedName.delegate = t
assert upperCasedName() == &#39;TEAPOT&#39;
</code></pre><p>æ­¤æ—¶ï¼Œè¡Œä¸ºä¸åœ¨é—­åŒ…çš„è¯æ³•èŒƒå›´ä¸­å®šä¹‰<code>target</code>å˜é‡æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼š</p><pre><code class="language-Groovy">def target = p
def upperCasedNameUsingVar = { target.name.toUpperCase() }
assert upperCasedNameUsingVar() == &#39;NORMAN&#39;
</code></pre><p>ä½†æ˜¯ï¼Œæœ‰ä¸»è¦åŒºåˆ«ï¼š</p><ul><li>åœ¨æœ€åä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œ<em>target</em>æ˜¯ä»é—­åŒ…å†…å¼•ç”¨çš„å±€éƒ¨å˜é‡</li><li>å§”æ‰˜å¯ä»¥é€æ˜åœ°ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ— éœ€åœ¨æ–¹æ³•è°ƒç”¨å‰åŠ ä¸Š<code>delegate</code>ã€‚å¦‚ä¸‹ä¸€æ®µæ‰€è¿°ã€‚</li></ul><h4 id="324-å§”æ‰˜ç­–ç•¥">3.2.4. å§”æ‰˜ç­–ç•¥</h4><p>æ¯å½“åœ¨é—­åŒ…ä¸­è®¿é—®ä¸€ä¸ªå±æ€§è€Œä¸æ˜¾å¼è®¾ç½®æ¥æ”¶å™¨å¯¹è±¡æ—¶ï¼Œå°±ä¼šæ¶‰åŠåˆ°å§”æ‰˜ç­–ç•¥ï¼š</p><pre><code class="language-Groovy">class Person {
    String name
}
def p = new Person(name:&#39;Igor&#39;)
def cl = { name.toUpperCase() }                 (1)
cl.delegate = p                                 (2)
assert cl() == &#39;IGOR&#39;                           (3)
</code></pre><table><thead><tr><th><strong>1</strong></th><th><code>name</code>æ²¡æœ‰å¼•ç”¨é—­åŒ…è¯æ³•èŒƒå›´å†…çš„å˜é‡</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>æˆ‘ä»¬å¯ä»¥å°†é—­åŒ…çš„å§”æ‰˜æ›´æ”¹ä¸º<code>Person</code>çš„å®ä¾‹</td></tr><tr><td><strong>3</strong></td><td>å¹¶ä¸”æ–¹æ³•è°ƒç”¨ä¼šæˆåŠŸ</td></tr></tbody></table><p>æ­¤ä»£ç æœ‰æ•ˆçš„åŸå› æ˜¯<code>name</code>å±æ€§å°†åœ¨<code>delegate</code>å¯¹è±¡ä¸Šé€æ˜åœ°è§£æï¼è¿™æ˜¯è§£å†³é—­åŒ…å†…çš„å±æ€§æˆ–æ–¹æ³•è°ƒç”¨çš„ä¸€ç§éå¸¸å¼ºå¤§çš„æ–¹æ³•ã€‚æ— éœ€è®¾ç½®æ˜¾å¼<code>delegate</code>ã€‚æ¥æ”¶è€…ï¼šå°†è¿›è¡Œè°ƒç”¨ï¼Œå› ä¸ºé—­åŒ…çš„é»˜è®¤å§”æ‰˜ç­–ç•¥ä½¿å…¶å¦‚æ­¤ã€‚é—­åŒ…å®é™…ä¸Šå®šä¹‰äº†å¤šç§è§£å†³ç­–ç•¥ï¼Œä½ å¯ä»¥é€‰æ‹©ï¼š</p><ul><li><code>Closure.OWNER_FIRST</code>æ˜¯<strong>é»˜è®¤ç­–ç•¥</strong>ã€‚å¦‚æœ<strong>owner</strong>ä¸Šå­˜åœ¨å±æ€§/æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°†åœ¨ownerä¸Šè°ƒç”¨ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™ä½¿ç”¨<strong>delegate</strong>ã€‚</li><li><code>Closure.DELEGATE_FIRST</code>åè½¬é€»è¾‘ï¼šå…ˆä½¿ç”¨<strong>delegate</strong>ï¼Œç„¶åä½¿ç”¨<strong>owner</strong></li><li><code>Closure.OWNER_ONLY</code>åªä¼šè§£ææ‰€æœ‰è€…çš„å±æ€§/æ–¹æ³•æŸ¥æ‰¾ï¼šå§”æ‰˜å°†è¢«å¿½ç•¥ã€‚</li><li><code>Closure.DELEGATE_ONLY</code>åªä¼šè§£æå§”æ‰˜ä¸Šçš„å±æ€§/æ–¹æ³•æŸ¥æ‰¾ï¼šæ‰€æœ‰è€…å°†è¢«å¿½ç•¥ã€‚</li><li><code>Closure.TO_SELF</code>å¯ä¾›éœ€è¦é«˜çº§å…ƒç¼–ç¨‹æŠ€æœ¯å¹¶å¸Œæœ›å®ç°è‡ªå®šä¹‰è§£æç­–ç•¥çš„å¼€å‘äººå‘˜ä½¿ç”¨ï¼šè§£æä¸ä¼šé’ˆå¯¹æ‰€æœ‰è€…æˆ–å§”æ‰˜ï¼Œè€Œåªä¼šé’ˆå¯¹é—­åŒ…ç±»æœ¬èº«ã€‚å¦‚æœä½ å®ç°è‡ªå·±çš„<code>Closure</code>å­ç±»ï¼Œåˆ™ä½¿ç”¨å®ƒæ‰æœ‰æ„ä¹‰ã€‚</li></ul><p>è®©æˆ‘ä»¬ç”¨è¿™æ®µä»£ç æ¥è¯´æ˜é»˜è®¤çš„â€œæ‰€æœ‰è€…ä¼˜å…ˆâ€ç­–ç•¥ï¼š</p><pre><code class="language-Groovy">class Person {
    String name
    def pretty = { &quot;My name is $name&quot; }             (1)
    String toString() {
        pretty()
    }
}
class Thing {
    String name                                     (2)
}def p = new Person(name: &#39;Sarah&#39;)
def t = new Thing(name: &#39;Teapot&#39;)assert p.toString() == &#39;My name is Sarah&#39;           (3)
p.pretty.delegate = t                               (4)
assert p.toString() == &#39;My name is Sarah&#39;           (5)
</code></pre><table><thead><tr><th><strong>1</strong></th><th>ä¸ºäº†è¯´æ˜ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¼•ç”¨â€œnameâ€çš„é—­åŒ…æˆå‘˜</th></tr></thead><tbody><tr><td><strong>2</strong></td><td><code>Person</code>å’Œ<code>Thing</code>ç±»éƒ½å®šä¹‰äº†ä¸€ä¸ª<code>name</code>å±æ€§</td></tr><tr><td><strong>3</strong></td><td>ä½¿ç”¨é»˜è®¤ç­–ç•¥ï¼Œé¦–å…ˆåœ¨æ‰€æœ‰è€…ä¸Šè§£æ<code>name</code>å±æ€§</td></tr><tr><td><strong>4</strong></td><td>å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å°†<code>delegate</code>æ›´æ”¹ä¸º<code>t</code>ï¼Œå®ƒæ˜¯<code>Thing</code>çš„ä¸€ä¸ªå®ä¾‹</td></tr><tr><td><strong>5</strong></td><td>ç»“æœæ²¡æœ‰å˜åŒ–ï¼š<code>name</code>é¦–å…ˆåœ¨é—­åŒ…çš„<code>owner</code>ä¸Šè§£æ</td></tr></tbody></table><p>ä½†æ˜¯ï¼Œå¯ä»¥æ›´æ”¹é—­åŒ…çš„è§£æç­–ç•¥ï¼š</p><pre><code class="language-Groovy">p.pretty.resolveStrategy = Closure.DELEGATE_FIRST
assert p.toString() == &#39;My name is Teapot&#39;
</code></pre><p>é€šè¿‡æ›´æ”¹<code>resolveStrategy</code>ï¼Œæˆ‘ä»¬æ­£åœ¨ä¿®æ”¹Groovyè§£æâ€œéšå¼ thisâ€å¼•ç”¨çš„æ–¹å¼ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>name</code>å°†é¦–å…ˆåœ¨å§”æ‰˜ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæœªæ‰¾åˆ°ï¼Œåˆ™åœ¨æ‰€æœ‰è€…ä¸­æŸ¥æ‰¾ã€‚ç”±äº<code>name</code>æ˜¯åœ¨å§”æ‰˜ä¸­å®šä¹‰çš„ï¼Œå®ƒæ˜¯<code>Thing</code>çš„ä¸€ä¸ªå®ä¾‹ï¼Œå› æ­¤ä½¿ç”¨æ­¤å€¼ã€‚</p><p>å¦‚æœå…¶ä¸­ä¸€ä¸ªå§”æ‰˜äººï¼ˆæˆ–æ‰€æœ‰è€…ï¼‰<strong>æ²¡æœ‰</strong>è¿™æ ·çš„æ–¹æ³•æˆ–å±æ€§ï¼Œåˆ™å¯ä»¥è¯´æ˜â€œå§”æ‰˜ä¼˜å…ˆâ€å’Œâ€œä»…å§”æ‰˜â€æˆ–â€œæ‰€æœ‰è€…ä¼˜å…ˆâ€å’Œâ€œä»…æ‰€æœ‰è€…â€ä¹‹é—´çš„åŒºåˆ«ï¼š</p><pre><code class="language-Groovy">class Person {
    String name
    int age
    def fetchAge = { age }
}
class Thing {
    String name
}def p = new Person(name:&#39;Jessica&#39;, age:42)
def t = new Thing(name:&#39;Printer&#39;)
def cl = p.fetchAge
cl.delegate = p
assert cl() == 42
cl.delegate = t
assert cl() == 42
cl.resolveStrategy = Closure.DELEGATE_ONLY
cl.delegate = p
assert cl() == 42
cl.delegate = t
try {
    cl()
    assert false
} catch (MissingPropertyException ex) {
    // &quot;age&quot; is not defined on the delegate
}
</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªç±»ï¼Œå®ƒä»¬éƒ½æœ‰ä¸€ä¸ª<code>name</code>å±æ€§ï¼Œä½†åªæœ‰<code>Person</code>ç±»å£°æ˜äº†ä¸€ä¸ª<code>age</code>ã€‚<code>Person</code>ç±»è¿˜å£°æ˜äº†ä¸€ä¸ªå¼•ç”¨<code>age</code>çš„é—­åŒ…ã€‚æˆ‘ä»¬å¯ä»¥å°†é»˜è®¤çš„è§£å†³ç­–ç•¥ä»â€œæ‰€æœ‰è€…ä¼˜å…ˆâ€æ›´æ”¹ä¸ºâ€œä»…ä»£è¡¨â€ã€‚ç”±äºé—­åŒ…çš„æ‰€æœ‰è€…æ˜¯<code>Person</code>ç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ£€æŸ¥ï¼Œå¦‚æœå§”æ‰˜æ˜¯<code>Person</code>çš„å®ä¾‹ï¼Œåˆ™è°ƒç”¨é—­åŒ…æ˜¯æˆåŠŸçš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä»¥å§”æ‰˜ä½œä¸º<code>Thing</code>çš„å®ä¾‹æ¥è°ƒç”¨å®ƒï¼Œå®ƒä¼šå¤±è´¥å¹¶å‡ºç°<code>groovy .lang.MissingPropertyException</code>ã€‚å°½ç®¡åœ¨<code>Person</code>ç±»ä¸­å®šä¹‰äº†é—­åŒ…ï¼Œä½†æ²¡æœ‰ä½¿ç”¨æ‰€æœ‰è€…ã€‚</p><h2 id="4-gstringsä¸­çš„é—­åŒ…">4. GStringsä¸­çš„é—­åŒ…</h2><p>é‡‡å–ä»¥ä¸‹ä»£ç ï¼š</p><pre><code class="language-Groovy">def x = 1
def gs = &quot;x = ${x}&quot;
assert gs == &#39;x = 1&#39;
</code></pre><p>ä»£ç çš„è¡Œä¸ºä¸ä½ é¢„æœŸçš„ä¸€æ ·ï¼Œä½†æ˜¯å¦‚æœä½ æ·»åŠ ä»¥ä¸‹å†…å®¹ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p><pre><code class="language-Groovy">x = 2
assert gs == &#39;x = 2&#39;
</code></pre><p>ä½ ä¼šçœ‹åˆ°æ–­è¨€å¤±è´¥äº†ï¼æœ‰ä¸¤ä¸ªåŸå› ï¼š</p><ul><li>GStringä»…æ‡’æƒ°åœ°æ‰§è¡Œå€¼çš„<code>toString</code>è¡¨ç¤º</li><li>GString ä¸­çš„è¯­æ³•<code>${x}</code>â€‹<strong>ä¸</strong>ä»£è¡¨é—­åŒ…ï¼Œè€Œæ˜¯<code>$x</code>çš„<strong>è¡¨è¾¾å¼</strong>ï¼Œåœ¨åˆ›å»ºGStringæ—¶è¿›è¡Œæ‰§è¡Œã€‚</li></ul><p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œ<code>GString</code>æ˜¯ä½¿ç”¨å¼•ç”¨<code>x</code>çš„è¡¨è¾¾å¼åˆ›å»ºçš„ã€‚åˆ›å»º<code>GString</code>æ—¶ï¼Œ<code>x</code>çš„<strong>å€¼</strong>ä¸º 1ï¼Œå› æ­¤åˆ›å»ºçš„<code>GString</code>çš„å€¼ä¸º 1ã€‚è§¦å‘æ–­è¨€æ—¶ï¼Œæ‰§è¡Œ<code>GString</code>å¹¶ä½¿ç”¨<code>toString</code>å°† 1 è½¬æ¢ä¸º<code>String</code>ã€‚å½“æˆ‘ä»¬å°†<code>x</code>æ›´æ”¹ä¸º 2 æ—¶ï¼Œæˆ‘ä»¬ç¡®å®æ›´æ”¹äº†<code>x</code>çš„å€¼ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œå¹¶ä¸”<code>GString</code>ä»ç„¶å¼•ç”¨æ—§çš„å¯¹è±¡ã€‚</p><table><thead><tr><th><br></th><th>åªæœ‰å½“<code>GString</code>å¼•ç”¨çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>GString</code>æ‰ä¼šæ›´æ”¹å…¶<code>toString</code>è¡¨ç¤ºã€‚å¦‚æœå¼•ç”¨å‘ç”Ÿå˜åŒ–ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚</th></tr></thead></table><p>å¦‚æœä½ éœ€è¦ GString ä¸­çš„çœŸæ­£é—­åŒ…ï¼Œä¾‹å¦‚å¼ºåˆ¶å¯¹å˜é‡è¿›è¡Œæƒ°æ€§æ±‚å€¼ï¼Œåˆ™éœ€è¦ä½¿ç”¨æ›¿ä»£è¯­æ³•<code>${â†’ x}</code>ï¼Œå¦‚å›ºå®šç¤ºä¾‹ä¸­æ‰€ç¤ºï¼š</p><pre><code class="language-Groovy">def x = 1
def gs = &quot;x = ${-&gt; x}&quot;
assert gs == &#39;x = 1&#39;

x = 2
assert gs == &#39;x = 2&#39;
</code></pre><p>è®©æˆ‘ä»¬ç”¨è¿™æ®µä»£ç æ¥è¯´æ˜å®ƒä¸å˜ä½“æœ‰ä½•ä¸åŒï¼š</p><pre><code class="language-Groovy">class Person {
    String name
    String toString() { name }          (1)
}
def sam = new Person(name:&#39;Sam&#39;)        (2)
def lucy = new Person(name:&#39;Lucy&#39;)      (3)
def p = sam                             (4)
def gs = &quot;Name: ${p}&quot;                   (5)
assert gs == &#39;Name: Sam&#39;                (6)
p = lucy                                (7)
assert gs == &#39;Name: Sam&#39;                (8)
sam.name = &#39;Lucy&#39;                       (9)
assert gs == &#39;Name: Lucy&#39;               (10)
</code></pre><table><thead><tr><th><strong>1</strong></th><th><code>Person</code>ç±»æœ‰ä¸€ä¸ª<code>toString</code>æ–¹æ³•è¿”å›<code>name</code>å±æ€§</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º<em>Sam</em>çš„<code>Person</code></td></tr><tr><td><strong>3</strong></td><td>æˆ‘ä»¬åˆ›å»ºå¦ä¸€ä¸ªåä¸º<em>Lucy</em>çš„<code>Person</code></td></tr><tr><td><strong>4</strong></td><td><code>p</code>å˜é‡è®¾ç½®ä¸º<code>Sam</code></td></tr><tr><td><strong>5</strong></td><td>å¹¶åˆ›å»ºä¸€ä¸ªé—­åŒ…ï¼Œå¼•ç”¨<code>p</code>çš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´<em>Sam</em></td></tr><tr><td><strong>6</strong></td><td>æ‰€ä»¥å½“æˆ‘ä»¬è¯„ä¼°å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šè¿”å›<em>Sam</em></td></tr><tr><td><strong>7</strong></td><td>å¦‚æœæˆ‘ä»¬å°†<code>p</code>æ›´æ”¹ä¸º<em>Lucy</em></td></tr><tr><td><strong>8</strong></td><td>è¯¥å­—ç¬¦ä¸²ä»ç„¶è®¡ç®—ä¸º<em>Sam</em>ï¼Œå› ä¸ºå®ƒæ˜¯åˆ›å»º<code>GString</code>æ—¶<code>p</code>çš„<strong>å€¼</strong></td></tr><tr><td><strong>9</strong></td><td>æ‰€ä»¥å¦‚æœæˆ‘ä»¬æŠŠnameçš„å€¼<em>Sam</em>æ”¹æˆ<em>Lucy</em></td></tr><tr><td><strong>10</strong></td><td>è¿™æ¬¡<code>GString</code>è¢«æ­£ç¡®åœ°æ”¹å˜äº†</td></tr></tbody></table><p>å› æ­¤ï¼Œå¦‚æœä½ ä¸æƒ³ä¾èµ–å˜å¼‚å¯¹è±¡æˆ–åŒ…è£…å¯¹è±¡ï¼Œåˆ™<strong>å¿…é¡»</strong>é€šè¿‡æ˜¾å¼å£°æ˜ä¸€ä¸ªç©ºå‚æ•°åˆ—è¡¨æ¥åœ¨<code>GString</code>ä¸­ä½¿ç”¨é—­åŒ…ï¼š</p><pre><code class="language-Groovy">class Person {
    String name
    String toString() { name }
}
def sam = new Person(name:&#39;Sam&#39;)
def lucy = new Person(name:&#39;Lucy&#39;)
def p = sam
// Create a GString with lazy evaluation of &quot;p&quot;
def gs = &quot;Name: ${-&gt; p}&quot;
assert gs == &#39;Name: Sam&#39;
p = lucy
assert gs == &#39;Name: Lucy&#39;
</code></pre><h2 id="5-å¼ºåˆ¶é—­åŒ…">5. å¼ºåˆ¶é—­åŒ…</h2><p>é—­åŒ…å¯ä»¥è½¬æ¢ä¸ºæ¥å£æˆ–å•æŠ½è±¡æ–¹æ³•ç±»å‹ã€‚æœ‰å…³å®Œæ•´è¯´æ˜ï¼Œè¯·å‚é˜…<a href="https://docs.groovy-lang.org/latest/html/documentation/core-semantics.html#closure-coercion">æ‰‹å†Œçš„è¿™ä¸€éƒ¨åˆ†</a>ã€‚</p><h2 id="6-å‡½æ•°å¼ç¼–ç¨‹">6. å‡½æ•°å¼ç¼–ç¨‹</h2><p>é—­åŒ…ï¼Œå¦‚<a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">Java 8ä¸­çš„lambdaè¡¨è¾¾å¼</a>ï¼Œæ˜¯Groovyä¸­å‡½æ•°å¼ç¼–ç¨‹èŒƒå¼çš„æ ¸å¿ƒã€‚å‡½æ•°çš„ä¸€äº›å‡½æ•°å¼ç¼–ç¨‹æ“ä½œå¯ä»¥ç›´æ¥åœ¨<code>Closure</code>ç±»ä¸Šä½¿ç”¨ï¼Œå¦‚æœ¬èŠ‚æ‰€ç¤ºã€‚</p><h3 id="61-æŸ¯é‡ŒåŒ–">6.1. æŸ¯é‡ŒåŒ–</h3><p>åœ¨Groovyä¸­ï¼ŒæŸ¯é‡ŒåŒ–æ˜¯æŒ‡éƒ¨åˆ†åº”ç”¨çš„æ¦‚å¿µã€‚ç”±äºGroovyåœ¨é—­åŒ…ä¸Šåº”ç”¨çš„ä¸åŒä½œç”¨åŸŸè§„åˆ™ï¼Œå®ƒ<strong>ä¸ç¬¦åˆ</strong>å‡½æ•°å¼ç¼–ç¨‹ä¸­æŸ¯é‡ŒåŒ–çš„çœŸæ­£æ¦‚å¿µã€‚ Groovyä¸­çš„æŸ¯é‡ŒåŒ–å°†å…è®¸ä½ è®¾ç½®é—­åŒ…çš„ä¸€ä¸ªå‚æ•°çš„å€¼ï¼Œå¹¶ä¸”å®ƒå°†è¿”å›ä¸€ä¸ªæ¥å—å°‘ä¸€ä¸ªå‚æ•°çš„æ–°é—­åŒ…ã€‚</p><h4 id="611-å·¦æŸ¯é‡ŒåŒ–">6.1.1. å·¦æŸ¯é‡ŒåŒ–</h4><p>å·¦æŸ¯é‡ŒåŒ–æ˜¯è®¾ç½®é—­åŒ…æœ€å·¦è¾¹çš„å‚æ•°ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><pre><code class="language-Groovy">def nCopies = { int n, String str -&gt; str*n }    (1)
def twice = nCopies.curry(2)                    (2)
assert twice(&#39;bla&#39;) == &#39;blabla&#39;                 (3)
assert twice(&#39;bla&#39;) == nCopies(2, &#39;bla&#39;)        (4)
</code></pre><table><thead><tr><th><strong>1</strong></th><th><code>nCopies</code>é—­åŒ…å®šä¹‰äº†ä¸¤ä¸ªå‚æ•°</th></tr></thead><tbody><tr><td><strong>2</strong></td><td><code>curry</code>å°†ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸º 2 ï¼Œåˆ›å»ºä¸€ä¸ªæ¥å—å•ä¸ª<code>String</code>çš„æ–°é—­åŒ…ï¼ˆå‡½æ•°ï¼‰</td></tr><tr><td><strong>3</strong></td><td>æ‰€ä»¥åªç”¨ä¸€ä¸ª<code>String</code>è°ƒç”¨æ–°çš„å‡½æ•°è°ƒç”¨</td></tr><tr><td><strong>4</strong></td><td>å¹¶ä¸”ç›¸å½“äºç”¨ä¸¤ä¸ªå‚æ•°è°ƒç”¨<code>nCopies</code></td></tr></tbody></table><h4 id="612-å³æŸ¯é‡ŒåŒ–">6.1.2. å³æŸ¯é‡ŒåŒ–</h4><p>ä¸å·¦æŸ¯é‡ŒåŒ–ç±»ä¼¼ï¼Œå¯ä»¥è®¾ç½®é—­åŒ…çš„æœ€å³ä¾§å‚æ•°ï¼š</p><pre><code class="language-Groovy">def nCopies = { int n, String str -&gt; str*n }    (1)
def blah = nCopies.rcurry(&#39;bla&#39;)                (2)
assert blah(2) == &#39;blabla&#39;                      (3)
assert blah(2) == nCopies(2, &#39;bla&#39;)             (4)
</code></pre><table><thead><tr><th><strong>1</strong></th><th><code>nCopies</code>é—­åŒ…å®šä¹‰äº†ä¸¤ä¸ªå‚æ•°</th></tr></thead><tbody><tr><td><strong>2</strong></td><td><code>rcurry</code>ä¼šå°†æœ€åä¸€ä¸ªå‚æ•°è®¾ç½®ä¸º<code>bla</code>ï¼Œåˆ›å»ºä¸€ä¸ªæ¥å—å•ä¸ª<code>int</code>çš„æ–°é—­åŒ…ï¼ˆå‡½æ•°ï¼‰</td></tr><tr><td><strong>3</strong></td><td>æ‰€ä»¥åªç”¨ä¸€ä¸ª<code>int</code>è°ƒç”¨æ–°çš„å‡½æ•°è°ƒç”¨</td></tr><tr><td><strong>4</strong></td><td>å¹¶ä¸”ç›¸å½“äºç”¨ä¸¤ä¸ªå‚æ•°è°ƒç”¨<code>nCopies</code></td></tr></tbody></table><h4 id="613-åŸºäºç´¢å¼•çš„æŸ¯é‡ŒåŒ–">6.1.3. åŸºäºç´¢å¼•çš„æŸ¯é‡ŒåŒ–</h4><p>å¦‚æœé—­åŒ…æ¥å—è¶…è¿‡ 2 ä¸ªå‚æ•°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>ncurry</code>è®¾ç½®ä»»æ„å‚æ•°ï¼š</p><pre><code class="language-Groovy">def volume = { double l, double w, double h -&gt; l*w*h }      (1)
def fixedWidthVolume = volume.ncurry(1, 2d)                 (2)
assert volume(3d, 2d, 4d) == fixedWidthVolume(3d, 4d)       (3)
def fixedWidthAndHeight = volume.ncurry(1, 2d, 4d)          (4)
assert volume(3d, 2d, 4d) == fixedWidthAndHeight(3d)        (5)
</code></pre><table><thead><tr><th><strong>1</strong></th><th><code>volume</code>å‡½æ•°å®šä¹‰äº†3ä¸ªå‚æ•°</th></tr></thead><tbody><tr><td><strong>2</strong></td><td><code>ncurry</code>å°†ç¬¬äºŒä¸ªå‚æ•° (index = 1) è®¾ç½®ä¸º<code>2d</code>ï¼Œåˆ›å»ºä¸€ä¸ªæ¥å—é•¿åº¦å’Œé«˜åº¦çš„æ–°ä½“ç§¯å‡½æ•°</td></tr><tr><td><strong>3</strong></td><td>è¯¥åŠŸèƒ½ç›¸å½“äºè°ƒç”¨<code>volume</code>çœç•¥å®½åº¦</td></tr><tr><td><strong>4</strong></td><td>ä¹Ÿå¯ä»¥è®¾ç½®å¤šä¸ªå‚æ•°ï¼Œä»æŒ‡å®šçš„ç´¢å¼•å¼€å§‹</td></tr><tr><td><strong>5</strong></td><td>ç»“æœå‡½æ•°æ¥å—ä¸åˆå§‹å‚æ•°ä¸€æ ·å¤šçš„å‚æ•°å‡å»<code>ncurry</code>è®¾ç½®çš„å‚æ•°æ•°é‡</td></tr></tbody></table><h3 id="62-è®°å¿†">6.2. è®°å¿†</h3><p>è®°å¿†åŒ–å…è®¸ç¼“å­˜è°ƒç”¨é—­åŒ…çš„ç»“æœã€‚å¦‚æœä¸€ä¸ªå‡½æ•°ï¼ˆé—­åŒ…ï¼‰å®Œæˆçš„è®¡ç®—å¾ˆæ…¢ï¼Œè¿™å¾ˆæœ‰è¶£ï¼Œä½†ä½ çŸ¥é“è¿™ä¸ªå‡½æ•°ä¼šç»å¸¸ç”¨ç›¸åŒçš„å‚æ•°è°ƒç”¨ã€‚ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯æ–æ³¢é‚£å¥‘å¥—ä»¶ã€‚ä¸€ä¸ªç®€å•çš„å®ç°å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class="language-Groovy">def fib
fib = { long n -&gt; n&lt;2?n:fib(n-1)+fib(n-2) }
assert fib(15) == 610 // slow!
</code></pre><p>è¿™æ˜¯ä¸€ä¸ªå¹¼ç¨šçš„å®ç°ï¼Œå› ä¸ºâ€œfibâ€é€šå¸¸ä½¿ç”¨ç›¸åŒçš„å‚æ•°é€’å½’è°ƒç”¨ï¼Œä»è€Œå¯¼è‡´æŒ‡æ•°ç®—æ³•ï¼š</p><ul><li>è®¡ç®—<code>fib(15)</code>éœ€è¦<code>fib(14)</code>å’Œ<code>fib(13)</code>çš„ç»“æœ</li><li>è®¡ç®—<code>fib(14)</code>éœ€è¦<code>fib(13)</code>å’Œ<code>fib(12)</code>çš„ç»“æœ</li></ul><p>ç”±äºè°ƒç”¨æ˜¯é€’å½’çš„ï¼Œä½ å·²ç»å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å°†ä¸€æ¬¡åˆä¸€æ¬¡åœ°è®¡ç®—ç›¸åŒçš„å€¼ï¼Œå°½ç®¡å®ƒä»¬å¯ä»¥è¢«ç¼“å­˜ã€‚è¿™ä¸ªå¹¼ç¨šçš„å®ç°å¯ä»¥é€šè¿‡ä½¿ç”¨<code>memoize</code>ç¼“å­˜è°ƒç”¨ç»“æœæ¥â€œä¿®å¤â€ï¼š</p><pre><code class="language-Groovy">fib = { long n -&gt; n&lt;2?n:fib(n-1)+fib(n-2) }.memoize()
assert fib(25) == 75025 // fast!
</code></pre><table><thead><tr><th><br></th><th>ç¼“å­˜<strong>ä½¿ç”¨å‚æ•°çš„å®é™…å€¼</strong>å·¥ä½œã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ å°†memoizationä¸åŸå§‹ç±»å‹æˆ–ç›’è£…åŸå§‹ç±»å‹ä»¥å¤–çš„å…¶ä»–å†…å®¹ä¸€èµ·ä½¿ç”¨ï¼Œä½ åº”è¯¥éå¸¸å°å¿ƒã€‚</th></tr></thead></table><p>å¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹æ³•è°ƒæ•´ç¼“å­˜çš„è¡Œä¸ºï¼š</p><ul><li><code>memoizeAtMost</code>å°†ç”Ÿæˆä¸€ä¸ªæ–°çš„é—­åŒ…ï¼Œ<strong>æœ€å¤š</strong>ç¼“å­˜nä¸ªå€¼</li><li><code>memoizeAtLeast</code>å°†ç”Ÿæˆä¸€ä¸ªç¼“å­˜<strong>è‡³å°‘</strong>nä¸ªå€¼çš„æ–°é—­åŒ…</li><li><code>memoizeBetween</code>å°†ç”Ÿæˆä¸€ä¸ªæ–°çš„é—­åŒ…ï¼Œå®ƒç¼“å­˜<strong>è‡³å°‘</strong>nä¸ªå€¼å’Œ<strong>æœ€å¤š</strong>nä¸ªå€¼</li></ul><p>æ‰€æœ‰memoizeå˜ä½“ä¸­ä½¿ç”¨çš„ç¼“å­˜éƒ½æ˜¯LRUç¼“å­˜ã€‚</p><h3 id="63-ç»„åˆ">6.3. ç»„åˆ</h3><p>é—­åŒ…ç»„åˆå¯¹åº”äºå‡½æ•°ç»„åˆçš„æ¦‚å¿µï¼Œå³é€šè¿‡ç»„åˆä¸¤ä¸ªæˆ–å¤šä¸ªå‡½æ•°ï¼ˆé“¾å¼è°ƒç”¨ï¼‰æ¥åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><pre><code class="language-Groovy">def plus2  = { it + 2 }
def times3 = { it * 3 }def times3plus2 = plus2 &lt;&lt; times3
assert times3plus2(3) == 11
assert times3plus2(4) == plus2(times3(4))def plus2times3 = times3 &lt;&lt; plus2
assert plus2times3(3) == 15
assert plus2times3(5) == times3(plus2(5))// reverse composition
assert times3plus2(3) == (times3 &gt;&gt; plus2)(3)
</code></pre><h3 id="64-è¹¦åºŠtrampoline">6.4. è¹¦åºŠTrampoline</h3><p>é€’å½’ç®—æ³•é€šå¸¸å—åˆ°ç‰©ç†é™åˆ¶çš„é™åˆ¶ï¼šæœ€å¤§å †æ ˆé«˜åº¦ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è°ƒç”¨ä¸€ä¸ªé€’å½’è°ƒç”¨è‡ªèº«å¤ªæ·±çš„æ–¹æ³•ï¼Œä½ æœ€ç»ˆä¼šæ”¶åˆ°ä¸€ä¸ª<code>StackOverflowException</code>ã€‚</p><p>åœ¨è¿™äº›æƒ…å†µä¸‹æœ‰å¸®åŠ©çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨<code>Closure</code>åŠå…¶trampolineåŠŸèƒ½ã€‚</p><p>é—­åŒ…è¢«åŒ…è£¹åœ¨<code>TrampolineClosure</code>ä¸­ã€‚è°ƒç”¨æ—¶ï¼Œè¹¦åºŠ<code>Closure</code>å°†è°ƒç”¨åŸå§‹<code>Closure</code>ç­‰å¾…å…¶ç»“æœã€‚å¦‚æœè°ƒç”¨çš„ç»“æœæ˜¯<code>TrampolineClosure</code>çš„å¦ä¸€ä¸ªå®ä¾‹ï¼Œå¯èƒ½æ˜¯ä½œä¸ºè°ƒç”¨<code>trampoline()</code>æ–¹æ³•çš„ç»“æœè€Œåˆ›å»ºçš„ï¼Œåˆ™å°†å†æ¬¡è°ƒç”¨<code>Closure</code>ã€‚è¿”å›çš„è¹¦åºŠé—­åŒ…å®ä¾‹çš„è¿™ç§é‡å¤è°ƒç”¨å°†ç»§ç»­ï¼Œç›´åˆ°è¿”å›è¹¦åºŠ<code>Closure</code>ä»¥å¤–çš„å€¼ã€‚è¯¥å€¼å°†æˆä¸ºè¹¦åºŠçš„æœ€ç»ˆç»“æœã€‚è¿™æ ·ï¼Œè°ƒç”¨æ˜¯è¿ç»­è¿›è¡Œçš„ï¼Œè€Œä¸æ˜¯å¡«å……å †æ ˆã€‚</p><p>ä¸‹é¢æ˜¯ä½¿ç”¨<code>trampoline()</code>å®ç°é˜¶ä¹˜å‡½æ•°çš„ç¤ºä¾‹ï¼š</p><pre><code class="language-Groovy">def factorial
factorial = { int n, def accu = 1G -&gt;
    if (n &lt; 2) return accu
    factorial.trampoline(n - 1, n * accu)
}
factorial = factorial.trampoline()
assert factorial(1)    == 1
assert factorial(3)    == 1 * 2 * 3
assert factorial(1000) // == 402387260.. plus another 2560 digits
</code></pre><h3 id="65-æ–¹æ³•æŒ‡é’ˆ">6.5. æ–¹æ³•æŒ‡é’ˆ</h3><p>èƒ½å¤Ÿä½¿ç”¨å¸¸è§„æ–¹æ³•ä½œä¸ºé—­åŒ…é€šå¸¸å¾ˆå®ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦ä½¿ç”¨é—­åŒ…çš„æŸ¯é‡ŒåŒ–åŠŸèƒ½ï¼Œä½†è¿™äº›åŠŸèƒ½ä¸é€‚ç”¨äºæ™®é€šæ–¹æ³•ã€‚åœ¨ Groovy ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨<a href="https://docs.groovy-lang.org/latest/html/documentation/core-operators.html#method-pointer-operator">æ–¹æ³•æŒ‡é’ˆè¿ç®—ç¬¦</a>ä»ä»»ä½•æ–¹æ³•ä¸­è·å–é—­åŒ…ã€‚</p><hr><p>ğŸ”— åŸæ–‡é“¾æ¥ï¼š <a href="https://groovy-lang.org/closures.html">https://groovy-lang.org/closures.htâ€¦</a></p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on ä¹æœˆ 27, 2024</p><div class="post__share"></div></footer><nav class="pagination"><div class="pagination__title"><span>Read other posts</span></div><div class="pagination__buttons"><a href="https://jobslee0.github.io/fan-yi-groovyying-yong-ji-cheng.html" class="btn previous" rel="prev" aria-label="[MISSING TRANSLATION]:  ã€ç¿»è¯‘ã€‘Groovyåº”ç”¨é›†æˆ "><span class="btn__icon">â†</span> <span class="btn__text">ã€ç¿»è¯‘ã€‘Groovyåº”ç”¨é›†æˆ</span> </a><a href="https://jobslee0.github.io/fan-yi-groovyying-yong-ji-cheng.html" class="btn next" rel="next" aria-label="[MISSING TRANSLATION]:  ã€ç¿»è¯‘ã€‘Groovyåº”ç”¨é›†æˆ "><span class="btn__text">ã€ç¿»è¯‘ã€‘Groovyåº”ç”¨é›†æˆ</span> <span class="btn__icon">â†’</span></a></div></nav></article></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p>Â© 2024 Powered by Publii CMS :: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank" rel="noopener">Theme</a> ported by the <a href="https://getpublii.com/customization-service/" target="_blank" rel="noopener">Publii Team</a></p></div></div></footer></div><script defer="defer" src="https://jobslee0.github.io/assets/js/scripts.min.js?v=c2232aa7558e9517946129d2a1b8c770"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>