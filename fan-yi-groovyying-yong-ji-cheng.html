<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ã€ç¿»è¯‘ã€‘Groovyåº”ç”¨é›†æˆ - Z.H.</title><meta name="description" content="Groovyæ˜¯ä¸€é—¨åŸºäºJVMçš„è¯­è¨€ï¼Œå ªç§°åŠ¨æ€è¯­è¨€ç‰ˆJavaï¼Œå…¶å„ç§åŠ¨æ€è¯­è¨€ç‰¹æ€§å¡«è¡¥äº†Javaçš„å„ç§ç©ºç¼ºï¼Œè®©äººæ‹æ¡ˆå«ç»â€¦â€¦æœ‰å¹¸æ¥è§¦Groovyï¼Œé‚æ‰‹åŠ¨ç¿»è¯‘ä¸‰ç¯‡å®˜æ–¹æ–‡æ¡£ï¼Œä»¥ä¾¿äºè¯»è€…ä»Javaåˆ°Groovyçš„å¿«é€Ÿè¿ç§»ã€‚ Groovy è¯­è¨€æå‡ºäº†å‡ ç§åœ¨è¿è¡Œæ—¶å°†è‡ªèº«é›†æˆåˆ°åº”ç”¨ç¨‹åºï¼ˆJava ç”šè‡³ Groovyï¼‰ä¸­çš„æ–¹æ³•ï¼Œä»æœ€åŸºæœ¬çš„ç®€å•ä»£ç æ‰§è¡Œåˆ°æœ€å®Œæ•´çš„é›†æˆç¼“å­˜å’Œç¼–è¯‘å™¨å®šåˆ¶ã€‚ è¿™ä¸ªgroovy.util.Evalç±»æ˜¯æœ€ç®€å•çš„æ–¹å¼åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„æ‰§è¡ŒGroovyã€‚å¯ä»¥ä½¿ç”¨meæ–¹æ³•ï¼š&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script type="text/javascript" async src="https://www.googletagmanager.com/gtag/js?id=6694651183"></script><script type="text/javascript">window.dataLayer = window.dataLayer || [];
				  function gtag(){dataLayer.push(arguments);}
				  gtag('js', new Date());
				  gtag('config', '6694651183' );
				  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NRGQEGZN7K"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NRGQEGZN7K');</script><link rel="canonical" href="https://jobslee0.github.io/fan-yi-groovyying-yong-ji-cheng.html"><link rel="alternate" type="application/atom+xml" href="https://jobslee0.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://jobslee0.github.io/feed.json"><meta property="og:title" content="ã€ç¿»è¯‘ã€‘Groovyåº”ç”¨é›†æˆ"><meta property="og:site_name" content="Z.H."><meta property="og:description" content="Groovyæ˜¯ä¸€é—¨åŸºäºJVMçš„è¯­è¨€ï¼Œå ªç§°åŠ¨æ€è¯­è¨€ç‰ˆJavaï¼Œå…¶å„ç§åŠ¨æ€è¯­è¨€ç‰¹æ€§å¡«è¡¥äº†Javaçš„å„ç§ç©ºç¼ºï¼Œè®©äººæ‹æ¡ˆå«ç»â€¦â€¦æœ‰å¹¸æ¥è§¦Groovyï¼Œé‚æ‰‹åŠ¨ç¿»è¯‘ä¸‰ç¯‡å®˜æ–¹æ–‡æ¡£ï¼Œä»¥ä¾¿äºè¯»è€…ä»Javaåˆ°Groovyçš„å¿«é€Ÿè¿ç§»ã€‚ Groovy è¯­è¨€æå‡ºäº†å‡ ç§åœ¨è¿è¡Œæ—¶å°†è‡ªèº«é›†æˆåˆ°åº”ç”¨ç¨‹åºï¼ˆJava ç”šè‡³ Groovyï¼‰ä¸­çš„æ–¹æ³•ï¼Œä»æœ€åŸºæœ¬çš„ç®€å•ä»£ç æ‰§è¡Œåˆ°æœ€å®Œæ•´çš„é›†æˆç¼“å­˜å’Œç¼–è¯‘å™¨å®šåˆ¶ã€‚ è¿™ä¸ªgroovy.util.Evalç±»æ˜¯æœ€ç®€å•çš„æ–¹å¼åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„æ‰§è¡ŒGroovyã€‚å¯ä»¥ä½¿ç”¨meæ–¹æ³•ï¼š&hellip;"><meta property="og:url" content="https://jobslee0.github.io/fan-yi-groovyying-yong-ji-cheng.html"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://jobslee0.github.io/media/website/photo2pixel_download-2.png" type="image/x-icon"><link rel="preload" href="https://jobslee0.github.io/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://jobslee0.github.io/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://jobslee0.github.io/assets/css/style.css?v=82007ae11cb9f2a56571c770331b13e7"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://jobslee0.github.io/fan-yi-groovyying-yong-ji-cheng.html"},"headline":"ã€ç¿»è¯‘ã€‘Groovyåº”ç”¨é›†æˆ","datePublished":"2023-01-09T15:45","dateModified":"2024-09-27T20:51","description":"Groovyæ˜¯ä¸€é—¨åŸºäºJVMçš„è¯­è¨€ï¼Œå ªç§°åŠ¨æ€è¯­è¨€ç‰ˆJavaï¼Œå…¶å„ç§åŠ¨æ€è¯­è¨€ç‰¹æ€§å¡«è¡¥äº†Javaçš„å„ç§ç©ºç¼ºï¼Œè®©äººæ‹æ¡ˆå«ç»â€¦â€¦æœ‰å¹¸æ¥è§¦Groovyï¼Œé‚æ‰‹åŠ¨ç¿»è¯‘ä¸‰ç¯‡å®˜æ–¹æ–‡æ¡£ï¼Œä»¥ä¾¿äºè¯»è€…ä»Javaåˆ°Groovyçš„å¿«é€Ÿè¿ç§»ã€‚ Groovy è¯­è¨€æå‡ºäº†å‡ ç§åœ¨è¿è¡Œæ—¶å°†è‡ªèº«é›†æˆåˆ°åº”ç”¨ç¨‹åºï¼ˆJava ç”šè‡³ Groovyï¼‰ä¸­çš„æ–¹æ³•ï¼Œä»æœ€åŸºæœ¬çš„ç®€å•ä»£ç æ‰§è¡Œåˆ°æœ€å®Œæ•´çš„é›†æˆç¼“å­˜å’Œç¼–è¯‘å™¨å®šåˆ¶ã€‚ è¿™ä¸ªgroovy.util.Evalç±»æ˜¯æœ€ç®€å•çš„æ–¹å¼åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„æ‰§è¡ŒGroovyã€‚å¯ä»¥ä½¿ç”¨meæ–¹æ³•ï¼š&hellip;","author":{"@type":"Person","name":"Jobs.Lee","url":"https://jobslee0.github.io/authors/jobslee/"},"publisher":{"@type":"Organization","name":"Jobs.Lee"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><div class="container container--center"><header class="header"><div class="header__logo"><a class="logo" href="https://jobslee0.github.io/">Z.H.</a></div></header><main class="content"><article class="post"><header><h1 class="post__title">ã€ç¿»è¯‘ã€‘Groovyåº”ç”¨é›†æˆ</h1><div class="post__meta"><time datetime="2023-01-09T15:45" class="post__date">ä¸€æœˆ 9, 2023 </time><span class="post__author"><a href="https://jobslee0.github.io/authors/jobslee/" class="feed__author">Jobs.Lee</a></span></div><div class="post__tags"><a href="https://jobslee0.github.io/tags/groovy/" class="invert">Groovy</a> <a href="https://jobslee0.github.io/tags/java/" class="invert">Java</a> <a href="https://jobslee0.github.io/tags/fan-yi/" class="invert">ç¿»è¯‘</a></div></header><div class="post__entry"><p>Groovyæ˜¯ä¸€é—¨åŸºäºJVMçš„è¯­è¨€ï¼Œå ªç§°åŠ¨æ€è¯­è¨€ç‰ˆJavaï¼Œå…¶å„ç§åŠ¨æ€è¯­è¨€ç‰¹æ€§å¡«è¡¥äº†Javaçš„å„ç§ç©ºç¼ºï¼Œè®©äººæ‹æ¡ˆå«ç»â€¦â€¦æœ‰å¹¸æ¥è§¦Groovyï¼Œé‚æ‰‹åŠ¨ç¿»è¯‘ä¸‰ç¯‡å®˜æ–¹æ–‡æ¡£ï¼Œä»¥ä¾¿äºè¯»è€…ä»Javaåˆ°Groovyçš„å¿«é€Ÿè¿ç§»ã€‚</p><hr><p>Groovy è¯­è¨€æå‡ºäº†å‡ ç§åœ¨è¿è¡Œæ—¶å°†è‡ªèº«é›†æˆåˆ°åº”ç”¨ç¨‹åºï¼ˆJava ç”šè‡³ Groovyï¼‰ä¸­çš„æ–¹æ³•ï¼Œä»æœ€åŸºæœ¬çš„ç®€å•ä»£ç æ‰§è¡Œåˆ°æœ€å®Œæ•´çš„é›†æˆç¼“å­˜å’Œç¼–è¯‘å™¨å®šåˆ¶ã€‚</p><table><thead><tr><th><br></th><th>æœ¬èŠ‚ä¸­ç¼–å†™çš„æ‰€æœ‰ç¤ºä¾‹éƒ½ä½¿ç”¨ Groovyï¼Œä½†å¯ä»¥åœ¨ Java ä¸­ä½¿ç”¨ç›¸åŒçš„é›†æˆæœºåˆ¶ã€‚</th></tr></thead></table><h3 id="11-eval">1.1. Eval</h3><p>è¿™ä¸ª<code>groovy.util.Eval</code>ç±»æ˜¯æœ€ç®€å•çš„æ–¹å¼åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„æ‰§è¡ŒGroovyã€‚å¯ä»¥ä½¿ç”¨<code>me</code>æ–¹æ³•ï¼š</p><pre><code class="language-Plaintext">import groovy.util.Evalassert Eval.me(&#39;33*3&#39;) == 99
assert Eval.me(&#39;&quot;foo&quot;.toUpperCase()&#39;) == &#39;FOO&#39;
</code></pre><p><code>Eval</code>æ”¯æŒå¤šç§å‚æ•°æ¥æ”¶å˜ä½“æ¥æ”¯æŒç®€æ˜“çš„è¡¨è¾¾å¼ï¼š</p><pre><code class="language-Plaintext">assert Eval.x(4, &#39;2*x&#39;) == 8                (1)
assert Eval.me(&#39;k&#39;, 4, &#39;2*k&#39;) == 8          (2)
assert Eval.xy(4, 5, &#39;x*y&#39;) == 20           (3)
assert Eval.xyz(4, 5, 6, &#39;x*y+z&#39;) == 26     (4)
</code></pre><table><thead><tr><th><strong>1</strong></th><th>ä¸€ä¸ªç»‘å®šäº†åç§°ä¸º<code>x</code>å‚æ•°çš„ç®€æ˜“è¡¨è¾¾å¼</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>è·Ÿä¸Šé¢çš„ä¸€æ ·ï¼Œä¸€ä¸ªç»‘å®šäº†åç§°ä¸º<code>k</code>å‚æ•°çš„ç®€æ˜“è¡¨è¾¾å¼</td></tr><tr><td><strong>3</strong></td><td>ä¸€ä¸ªç»‘å®šäº†<code>x</code>å’Œ<code>y</code>ä¸¤ä¸ªç»‘å®šå‚æ•°çš„ç®€æ˜“è¡¨è¾¾å¼</td></tr><tr><td><strong>4</strong></td><td>ä¸€ä¸ªç»‘å®šäº†<code>x</code>ã€<code>y</code>å’Œ<code>z</code>ä¸‰ä¸ªç»‘å®šå‚æ•°çš„ç®€æ˜“è¡¨è¾¾å¼</td></tr></tbody></table><p><code>Eval</code>ç±»ä½¿å¾—æ‰§è¡Œç®€æ˜“çš„è„šæœ¬å˜å¾—å®¹æ˜“ï¼Œä½†æ˜¯å¯¹äºå¤§è§„æ¨¡çš„è„šæœ¬ä¸è¡Œï¼šæ²¡æœ‰è„šæœ¬ç¼“å­˜ï¼Œè€Œä¸”ä¸èƒ½æ‰§è¡Œè¶…è¿‡ä¸€è¡Œçš„è¡¨è¾¾å¼ã€‚</p><h3 id="12-groovyshell">1.2. GroovyShell</h3><h4 id="121-å¤šç§æ¥æº">1.2.1. å¤šç§æ¥æº</h4><p><code>groovy.lang.GroovyShell</code>ç±»æ˜¯æ‰§è¡Œè„šæœ¬çš„é¦–é€‰æ–¹å¼ï¼Œèƒ½å¤Ÿç¼“å­˜ç”Ÿæˆçš„è„šæœ¬å®ä¾‹ã€‚å°½ç®¡<code>Eval</code>ç±»èƒ½å¤Ÿè¿”å›ç¼–è¯‘åè„šæœ¬çš„æ‰§è¡Œç»“æœï¼Œ<code>GroovyShell</code>å¯ä»¥æä¾›æ›´å¤šçš„é€‰æ‹©ã€‚</p><pre><code class="language-Plaintext">def shell = new GroovyShell()                           (1)
def result = shell.evaluate &#39;3*5&#39;                       (2)
def result2 = shell.evaluate(new StringReader(&#39;3*5&#39;))   (3)
assert result == result2
def script = shell.parse &#39;3*5&#39;                          (4)
assert script instanceof groovy.lang.Script
assert script.run() == 15                               (5)
</code></pre><table><thead><tr><th><strong>1</strong></th><th>åˆ›å»ºä¸€ä¸ªæ–°çš„<code>GroovyShell</code>å®ä¾‹</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>å¯ä»¥ä½œä¸º<code>Eval</code>ç›´æ¥æ‰§è¡Œä»£ç </td></tr><tr><td><strong>3</strong></td><td>èƒ½å¤Ÿä»å¾ˆå¤šæºè¯»å–ï¼ˆ<code>String</code>,<code>Reader</code>,<code>File</code>,<code>InputStream</code>ï¼‰</td></tr><tr><td><strong>4</strong></td><td>å¯ä»¥å»¶è¿Ÿè„šæœ¬çš„æ‰§è¡Œã€‚ä½¿ç”¨<code>parse</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>Script</code>å®ä¾‹</td></tr><tr><td><strong>5</strong></td><td><code>Script</code>å®šä¹‰äº†ä¸€ä¸ª<code>run</code>æ–¹æ³•</td></tr></tbody></table><h4 id="122-åœ¨è„šæœ¬å’Œåº”ç”¨é—´å…±äº«æ•°æ®">1.2.2. åœ¨è„šæœ¬å’Œåº”ç”¨é—´å…±äº«æ•°æ®</h4><p>é€šè¿‡ä½¿ç”¨<code>groovy.lang.Binding</code>å»åœ¨è„šæœ¬å’Œåº”ç”¨é—´å…±äº«æ•°æ®ï¼š</p><pre><code class="language-Plaintext">def sharedData = new Binding()                          (1)
def shell = new GroovyShell(sharedData)                 (2)
def now = new Date()
sharedData.setProperty(&#39;text&#39;, &#39;I am shared data!&#39;)     (3)
sharedData.setProperty(&#39;date&#39;, now)                     (4)
String result = shell.evaluate(&#39;&quot;At $date, $text&quot;&#39;)     (5)
assert result == &quot;At $now, I am shared data!&quot;
</code></pre><table><thead><tr><th><strong>1</strong></th><th>åˆ›å»ºä¸€ä¸ªåŒ…å«å…±äº«æ•°æ®çš„æ–°<code>Binding</code></th></tr></thead><tbody><tr><td><strong>2</strong></td><td>ä½¿ç”¨å…±äº«æ•°æ®åˆ›å»ºä¸€ä¸ª<code>GroovyShell</code></td></tr><tr><td><strong>3</strong></td><td>æ·»åŠ å­—ç¬¦ä¸²åˆ°ç»‘å®šä¸­</td></tr><tr><td><strong>4</strong></td><td>æ·»åŠ ä¸€ä¸ªæ—¥æœŸåˆ°ç»‘å®šä¸­ï¼ˆä½ å¯ä»¥ä¸å¿…é™åˆ¶äºç®€å•çš„ç±»å‹ï¼‰</td></tr><tr><td><strong>5</strong></td><td>æ‰§è¡Œè„šæœ¬</td></tr></tbody></table><p>æ³¨æ„ï¼Œä¹Ÿæœ‰å¯ä»¥åœ¨è„šæœ¬ä¸­å†™å…¥ç»‘å®šï¼š</p><pre><code class="language-Plaintext">def sharedData = new Binding()                          (1)
def shell = new GroovyShell(sharedData)                 (2)

shell.evaluate(&#39;foo=123&#39;)                               (3)
assert sharedData.getProperty(&#39;foo&#39;) == 123             (4)
</code></pre><table><thead><tr><th><strong>1</strong></th><th>åˆ›å»ºä¸€ä¸ª<code>Binding</code>å®ä¾‹</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>ä½¿ç”¨å…±äº«æ•°æ®åˆ›å»ºä¸€ä¸ªæ–°çš„<code>GroovyShell</code></td></tr><tr><td><strong>3</strong></td><td>åœ¨ç»‘å®šä¸­ä½¿ç”¨ä¸€ä¸ª<strong>æœªå£°æ˜çš„</strong>å˜é‡å»å­˜å‚¨ç»“æœ</td></tr><tr><td><strong>4</strong></td><td>åœ¨å›è°ƒä¸­è¯»å–ç»“æœ</td></tr></tbody></table><p>å¦‚æœä½ æƒ³ä½¿ç”¨ç»‘å®šï¼Œä¸€ä¸ªæœªå£°æ˜å˜é‡æ˜¯å¾ˆé‡è¦çš„ã€‚åƒä¸‹é¢ä¾‹å­ä¸€æ ·ä½¿ç”¨<code>def</code>æˆ–è€…<code>explicit</code>ç±»å‹å°†ä¼šå¤±è´¥ï¼Œå› ä¸ºä½ å°†ä¼šåˆ›å»ºä¸€ä¸ª<em>æœ¬åœ°</em>å˜é‡ï¼š</p><pre><code class="language-Plaintext">def sharedData = new Binding()
def shell = new GroovyShell(sharedData)

shell.evaluate(&#39;int foo=123&#39;)try {
    assert sharedData.getProperty(&#39;foo&#39;)
} catch (MissingPropertyException e) {
    println &quot;foo is defined as a local variable&quot;
}
</code></pre><table><thead><tr><th><br></th><th>ä½ åœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨å…±äº«å˜é‡æ—¶å¿…é¡»éå¸¸å°å¿ƒã€‚ä¼ é€’ç»™<code>GroovyShell</code>çš„<code>Binding</code>å®ä¾‹ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¼šè¢«æ‰€æœ‰çš„è„šæœ¬å…±äº«ã€‚</th></tr></thead></table><p>å¯ä»¥é€šè¿‡åˆ©ç”¨<code>parse</code>è¿”å›çš„<code>Script</code>å®ä¾‹æ¥è§£å†³<code>Binding</code>çš„å…±äº«å®ä¾‹ï¼š</p><pre><code class="language-Plaintext">def shell = new GroovyShell()def b1 = new Binding(x:3)                       (1)
def b2 = new Binding(x:4)                       (2)
def script = shell.parse(&#39;x = 2*x&#39;)
script.binding = b1
script.run()
script.binding = b2
script.run()
assert b1.getProperty(&#39;x&#39;) == 6
assert b2.getProperty(&#39;x&#39;) == 8
assert b1 != b2
</code></pre><table><thead><tr><th><strong>1</strong></th><th>å°†<code>x</code>å˜é‡å­˜å‚¨åœ¨<code>b1</code>ä¸­</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>å°†<code>x</code>å˜é‡å­˜å‚¨åœ¨<code>b2</code>ä¸­</td></tr></tbody></table><p>ä½†æ˜¯ï¼Œä½ å¿…é¡»çŸ¥é“ä½ ä»åœ¨å…±äº«<strong>åŒä¸€è„šæœ¬å®ä¾‹</strong>ã€‚å› æ­¤ï¼Œå¦‚æœä½ æœ‰ä¸¤ä¸ªçº¿ç¨‹å¤„ç†åŒä¸€ä¸ªè„šæœ¬ï¼Œåˆ™æ— æ³•ä½¿ç”¨æ­¤æŠ€æœ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¿…é¡»ç¡®ä¿åˆ›å»ºä¸¤ä¸ªä¸åŒçš„è„šæœ¬å®ä¾‹ï¼š</p><pre><code class="language-Plaintext">def shell = new GroovyShell()def b1 = new Binding(x:3)
def b2 = new Binding(x:4)
def script1 = shell.parse(&#39;x = 2*x&#39;)            (1)
def script2 = shell.parse(&#39;x = 2*x&#39;)            (2)
assert script1 != script2
script1.binding = b1                            (3)
script2.binding = b2                            (4)
def t1 = Thread.start { script1.run() }         (5)
def t2 = Thread.start { script2.run() }         (6)
[t1,t2]*.join()                                 (7)
assert b1.getProperty(&#39;x&#39;) == 6
assert b2.getProperty(&#39;x&#39;) == 8
assert b1 != b2
</code></pre><table><thead><tr><th><strong>1</strong></th><th>ä¸ºçº¿ç¨‹1åˆ›å»ºä¸€ä¸ªå®ä¾‹</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>ä¸ºçº¿ç¨‹2åˆ›å»ºä¸€ä¸ªå®ä¾‹</td></tr><tr><td><strong>3</strong></td><td>å°†ç¬¬ä¸€ä¸ªç»‘å®šåˆ†é…ç»™è„šæœ¬1</td></tr><tr><td><strong>4</strong></td><td>å°†ç¬¬ä¸€ä¸ªç»‘å®šåˆ†é…ç»™è„šæœ¬2</td></tr><tr><td><strong>5</strong></td><td>åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­å¯åŠ¨ç¬¬ä¸€ä¸ªè„šæœ¬</td></tr><tr><td><strong>6</strong></td><td>åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­å¯åŠ¨ç¬¬äºŒä¸ªè„šæœ¬</td></tr><tr><td><strong>7</strong></td><td>ç­‰å¾…å®Œæˆ</td></tr></tbody></table><p>å¦‚æœä½ éœ€è¦åƒè¿™é‡Œè¿™æ ·çš„çº¿ç¨‹å®‰å…¨ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨ GroovyClassLoaderã€‚</p><h4 id="123-è‡ªå®šä¹‰è„šæœ¬ç±»">1.2.3. è‡ªå®šä¹‰è„šæœ¬ç±»</h4><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>parse</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>groovy.lang.Script</code>çš„å®ä¾‹ï¼Œä½†æ˜¯æœ‰å¯èƒ½éœ€è¦å»ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»å»æ‰©å±•<code>Script</code>æœ¬èº«ã€‚å®ƒå¯ç”¨äºä¸ºè„šæœ¬æä¾›é¢å¤–çš„è¡Œä¸ºï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><pre><code class="language-Plaintext">abstract class MyScript extends Script {
    String name

    String greet() {
        &quot;Hello, $name!&quot;
    }
}
</code></pre><p>è¿™ä¸ªè‡ªå®šä¹‰ç±»å®šä¹‰äº†ä¸€ä¸ªå«åš<code>name</code>çš„å‚æ•°å’Œä¸€ä¸ªå«åš<code>greet</code>çš„æ–¹æ³•ã€‚è¿™ä¸ªç±»å¯ä»¥é€šè¿‡ä¸€ä¸ªè‡ªå®šä¹‰çš„é…ç½®æ¥è¢«ç”¨ä½œè„šæœ¬çš„åŸºç¡€ç±»ï¼š</p><pre><code class="language-Plaintext">import org.codehaus.groovy.control.CompilerConfigurationdef config = new CompilerConfiguration()                                    (1)
config.scriptBaseClass = &#39;MyScript&#39;                                         (2)
def shell = new GroovyShell(this.class.classLoader, new Binding(), config)  (3)
def script = shell.parse(&#39;greet()&#39;)                                         (4)
assert script instanceof MyScript
script.setName(&#39;Michel&#39;)
assert script.run() == &#39;Hello, Michel!&#39;
</code></pre><table><thead><tr><th><strong>1</strong></th><th>åˆ›å»ºä¸€ä¸ª<code>CompilerConfiguration</code>å®ä¾‹</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>æŒ‡å®š<code>MyScript</code>ä½œä¸ºè„šæœ¬çš„åŸºç¡€ç±»</td></tr><tr><td><strong>3</strong></td><td>ç„¶ååœ¨åˆ›å»º shell æ—¶ä½¿ç”¨ç¼–è¯‘å™¨é…ç½®</td></tr><tr><td><strong>4</strong></td><td>è¯¥è„šæœ¬ç°åœ¨å¯ä»¥è®¿é—®æ–°æ–¹æ³•<code>greet</code></td></tr></tbody></table><table><thead><tr><th><br></th><th>ä½ ä¸ä»…å±€é™äºå”¯ä¸€çš„<em>scriptBaseClass</em>é…ç½®ã€‚ä½ èƒ½å¤Ÿè°ƒæ•´ä»»æ„çš„ç¼–è¯‘å™¨é…ç½®ï¼ŒåŒ…æ‹¬<a href="https://docs.groovy-lang.org/latest/html/documentation/core-domain-specific-languages.html#compilation-customizers">compilation customizers</a>ã€‚</th></tr></thead></table><h3 id="13-groovyclassloader">1.3. GroovyClassLoader</h3><p>åœ¨ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬å·²ç»å±•ç¤ºäº†<code>GroovyShell</code>æ˜¯ä¸€ä¸ªæ‰§è¡Œè„šæœ¬çš„ç®€å•å·¥å…·ï¼Œä½†æ˜¯é™¤äº†è„šæœ¬ä¹‹å¤–ï¼Œç¼–è¯‘ä»»ä½•ä¸œè¥¿éƒ½å˜å¾—å¾ˆå¤æ‚ã€‚åœ¨å†…éƒ¨ï¼Œå®ƒä½¿ç”¨<code>groovy.lang.GroovyClassLoader</code> ï¼Œè¿™æ˜¯è¿è¡Œæ—¶ç¼–è¯‘å’ŒåŠ è½½ç±»çš„æ ¸å¿ƒã€‚</p><p>é€šè¿‡ä½¿ç”¨<code>GroovyClassLoader</code>æ›¿ä»£<code>GroovyShell</code>ï¼Œä½ å°†èƒ½å¤ŸåŠ è½½ç±»ï¼Œè€Œä¸æ˜¯è„šæœ¬å®ä¾‹ï¼š</p><pre><code class="language-Plaintext">import groovy.lang.GroovyClassLoaderdef gcl = new GroovyClassLoader()                                           (1)
def clazz = gcl.parseClass(&#39;class Foo { void doIt() { println &quot;ok&quot; } }&#39;)    (2)
assert clazz.name == &#39;Foo&#39;                                                  (3)
def o = clazz.newInstance()                                                 (4)
o.doIt()                                                                    (5)
</code></pre><table><thead><tr><th><strong>1</strong></th><th>åˆ›å»ºä¸€ä¸ªæ–°çš„<code>GroovyClassLoader</code></th></tr></thead><tbody><tr><td><strong>2</strong></td><td><code>parseClass</code>å°†ä¼šè¿”å›<code>Class</code>çš„å®ä¾‹</td></tr><tr><td><strong>3</strong></td><td>ä½ å¯ä»¥æ£€æŸ¥è¿”å›çš„ç±»æ˜¯å¦çœŸçš„æ˜¯è„šæœ¬ä¸­å®šä¹‰çš„ç±»</td></tr><tr><td><strong>4</strong></td><td>ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å®ä¾‹ï¼Œå®ƒä¸æ˜¯è„šæœ¬</td></tr><tr><td><strong>5</strong></td><td>ç„¶åè°ƒç”¨å®ƒçš„ä»»ä½•æ–¹æ³•</td></tr></tbody></table><table><thead><tr><th><br></th><th>GroovyClassLoaderä¿ç•™äº†å®ƒåˆ›å»ºçš„æ‰€æœ‰ç±»çš„å¼•ç”¨ï¼Œå› æ­¤å¾ˆå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœä½ æ‰§è¡Œä¸¤æ¬¡ç›¸åŒçš„è„šæœ¬ï¼Œå¦‚æœå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆä½ å°†è·å¾—ä¸¤ä¸ªä¸åŒçš„ç±»ï¼</th></tr></thead></table><pre><code class="language-Plaintext">import groovy.lang.GroovyClassLoaderdef gcl = new GroovyClassLoader()
def clazz1 = gcl.parseClass(&#39;class Foo { }&#39;)                                (1)
def clazz2 = gcl.parseClass(&#39;class Foo { }&#39;)                                (2)
assert clazz1.name == &#39;Foo&#39;                                                 (3)
assert clazz2.name == &#39;Foo&#39;
assert clazz1 != clazz2                                                     (4)
</code></pre><table><thead><tr><th><strong>1</strong></th><th>åŠ¨æ€åˆ›å»ºä¸€ä¸ªåä¸ºâ€œFooâ€çš„ç±»</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>ä½¿ç”¨å•ç‹¬çš„<code>parseClass</code>è°ƒç”¨åˆ›å»ºä¸€ä¸ªå¤–è§‚ç›¸åŒçš„ç±»</td></tr><tr><td><strong>3</strong></td><td>ç¡®ä¿ä¸¤ä¸ªç±»å…·æœ‰ç›¸åŒçš„åç§°</td></tr><tr><td><strong>4</strong></td><td>ä½†å®ƒä»¬å®é™…ä¸Šæ˜¯ä¸åŒçš„ï¼</td></tr></tbody></table><p>åŸå› æ˜¯<code>GroovyClassLoader</code>ä¸è·Ÿè¸ªæºæ–‡æœ¬ã€‚å¦‚æœä½ æƒ³æ‹¥æœ‰ç›¸åŒçš„å®ä¾‹ï¼Œåˆ™æº<strong>å¿…é¡»</strong>æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><pre><code class="language-Plaintext">def gcl = new GroovyClassLoader()
def clazz1 = gcl.parseClass(file)                                           (1)
def clazz2 = gcl.parseClass(new File(file.absolutePath))                    (2)
assert clazz1.name == &#39;Foo&#39;                                                 (3)
assert clazz2.name == &#39;Foo&#39;
assert clazz1 == clazz2                                                     (4)
</code></pre><table><thead><tr><th><strong>1</strong></th><th>ä»<code>æ–‡ä»¶</code>ä¸­è§£æä¸€ä¸ªç±»</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>ä»ä¸åŒçš„æ–‡ä»¶å®ä¾‹è§£æä¸€ä¸ªç±»ï¼Œä½†æŒ‡å‘åŒä¸€ä¸ªç‰©ç†æ–‡ä»¶</td></tr><tr><td><strong>3</strong></td><td>ç¡®ä¿æˆ‘ä»¬çš„ç±»å…·æœ‰ç›¸åŒçš„åç§°</td></tr><tr><td><strong>4</strong></td><td>ä½†ç°åœ¨ï¼Œå®ƒä»¬æ˜¯åŒä¸€ä¸ªå®ä¾‹</td></tr></tbody></table><p>ä½¿ç”¨ä¸€ä¸ª<code>File</code>ä½œä¸ºè¾“å…¥ï¼Œ<code>GroovyClassLoader</code>æ˜¯æœ‰èƒ½åŠ›<strong>ç¼“å­˜</strong>ç”Ÿæˆçš„ç±»æ–‡ä»¶çš„ï¼Œè¿™æ ·èƒ½å¤Ÿé¿å…åœ¨è¿è¡Œæ—¶åˆ›å»ºå¤šä¸ªåŒæºç±»ã€‚</p><h3 id="14-groovyscriptengine">1.4. GroovyScriptEngine</h3><p><code>groovy.util.GroovyScriptEngine</code>ç±»ä¸ºæœ‰è„šæœ¬ä¾èµ–çš„åº”ç”¨ç¨‹åºæä¾›äº†çµæ´»çš„è„šæœ¬é‡è½½åŸºç¡€ã€‚è™½ç„¶<code>GroovyShell</code>ä¸“æ³¨äºç‹¬ç«‹è„šæœ¬ï¼Œè€Œ<code>GroovyClassLoader</code>å¤„ç†ä»»ä½• Groovy ç±»çš„åŠ¨æ€ç¼–è¯‘å’ŒåŠ è½½ï¼Œä½†æ˜¯<code>GroovyScriptEngine</code>å°†åœ¨<code>GroovyClassLoader</code>ä¹‹ä¸Šæ·»åŠ ä¸€ä¸ªå±‚æ¥å¤„ç†è„šæœ¬ä¾èµ–å…³ç³»å’Œé‡æ–°åŠ è½½ã€‚</p><p>ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªè„šæœ¬å¼•æ“å¹¶åœ¨æ— é™å¾ªç¯ä¸­æ‰§è¡Œä»£ç ã€‚é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹è„šæœ¬ï¼š</p><p>ReloadingTest.groovy</p><pre><code class="language-Plaintext">class Greeter {
    String sayHello() {
        def greet = &quot;Hello, world!&quot;
        greet
    }
}new Greeter()
</code></pre><p>ç„¶åä½ å¯ä»¥ä½¿ç”¨<code>GroovyScriptEngine</code>æ‰§è¡Œæ­¤ä»£ç ï¼š</p><pre><code class="language-Plaintext">def binding = new Binding()
def engine = new GroovyScriptEngine([tmpDir.toURI().toURL()] as URL[])          (1)while (true) {
    def greeter = engine.run(&#39;ReloadingTest.groovy&#39;, binding)                   (2)
    println greeter.sayHello()                                                  (3)
    Thread.sleep(1000)
}
</code></pre><table><thead><tr><th><strong>1</strong></th><th>åˆ›å»ºä¸€ä¸ªè„šæœ¬å¼•æ“ï¼Œå®ƒå°†åœ¨æˆ‘ä»¬çš„æºç›®å½•ä¸­æŸ¥æ‰¾æº</th></tr></thead><tbody><tr><td><strong>2</strong></td><td>æ‰§è¡Œè„šæœ¬ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ª<code>Greeter</code>çš„å®ä¾‹</td></tr><tr><td><strong>3</strong></td><td>æ‰“å°é—®å€™è¯­</td></tr></tbody></table><p>æ­¤æ—¶ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°æ¯ç§’æ‰“å°ä¸€æ¡æ¶ˆæ¯ï¼š</p><p>Hello, world!Hello, world!â€¦</p><p>åœ¨<strong>ä¸ä¸­æ–­</strong>è„šæœ¬æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œç°åœ¨å°†<code>ReloadingTest</code>æ–‡ä»¶çš„å†…å®¹æ›¿æ¢ä¸ºï¼š</p><p>ReloadingTest.groovy</p><pre><code class="language-Plaintext">class Greeter {
    String sayHello() {
        def greet = &quot;Hello, Groovy!&quot;
        greet
    }
}new Greeter()
</code></pre><p>æ¶ˆæ¯åº”æ›´æ”¹ä¸ºï¼š</p><p>Hello, world!â€¦Hello, Groovy!Hello, Groovy!â€¦</p><p>ä½†ä¹Ÿå¯èƒ½ä¾èµ–äºå¦ä¸€ä¸ªè„šæœ¬ã€‚ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œåœ¨åŒä¸€ç›®å½•ä¸­åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼Œè€Œä¸ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„è„šæœ¬ï¼š</p><p>Dependency.groovy</p><pre><code class="language-Plaintext">class Dependency {
    String message = &#39;Hello, dependency 1&#39;
}
</code></pre><p>å¹¶åƒè¿™æ ·æ›´æ–°<code>ReloadingTest</code>è„šæœ¬ï¼š</p><p>ReloadingTest.groovy</p><pre><code class="language-Plaintext">import Dependencyclass Greeter {
    String sayHello() {
        def greet = new Dependency().message
        greet
    }
}new Greeter()
</code></pre><p>è¿™ä¸€æ¬¡ï¼Œæ¶ˆæ¯åº”è¯¥å˜ä¸ºï¼š</p><p>Hello, Groovy!â€¦Hello, dependency 1!Hello, dependency 1!â€¦</p><p>ä½œä¸ºæœ€åä¸€ä¸ªæµ‹è¯•ï¼Œä½ å¯ä»¥æ›´æ–°<code>Dependency.groovy</code>æ–‡ä»¶ï¼Œè€Œæ— éœ€è§¦åŠ<code>ReloadingTest</code>æ–‡ä»¶ï¼š</p><p>Dependency.groovy</p><pre><code class="language-Plaintext">class Dependency {
    String message = &#39;Hello, dependency 2&#39;
}
</code></pre><p>ä½ åº”è¯¥è§‚å¯Ÿåˆ°ä¾èµ–æ–‡ä»¶å·²é‡æ–°åŠ è½½ï¼š</p><p>Hello, dependency 1!â€¦Hello, dependency 2!Hello, dependency 2!</p><h3 id="15-compilationunit">1.5. CompilationUnit</h3><p>æœ€ç»ˆï¼Œé€šè¿‡ç›´æ¥ä¾èµ–<code>org.codehaus.groovy.control.CompilationUnit</code>ç±»ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æœŸé—´æ‰§è¡Œæ›´å¤šæ“ä½œã€‚è¯¥ç±»è´Ÿè´£ç¡®å®šç¼–è¯‘çš„å„ä¸ªæ­¥éª¤ï¼Œå¹¶å…è®¸ä½ å¼•å…¥æ–°æ­¥éª¤ï¼Œç”šè‡³åœ¨å„ä¸ªé˜¶æ®µåœæ­¢ç¼–è¯‘ã€‚ä¾‹å¦‚ï¼Œå¯¹äºè”åˆç¼–è¯‘å™¨ï¼Œå­˜æ ¹ç”Ÿæˆæ˜¯å¦‚ä½•å®Œæˆçš„ã€‚</p><p>ä½†æ˜¯ï¼Œä¸å»ºè®®è¦†ç›–<code>CompilationUnit</code>ï¼Œåªæœ‰åœ¨æ²¡æœ‰å…¶ä»–æ ‡å‡†è§£å†³æ–¹æ¡ˆæœ‰æ•ˆçš„æƒ…å†µä¸‹æ‰åº”è¯¥è¿™æ ·åšã€‚</p><hr><p>ğŸ”— åŸæ–‡é“¾æ¥ï¼š <a href="https://groovy-lang.org/integrating.html">https://groovy-lang.org/integratingâ€¦</a></p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on ä¹æœˆ 27, 2024</p><div class="post__share"></div></footer><nav class="pagination"><div class="pagination__title"><span>Read other posts</span></div><div class="pagination__buttons"><a href="https://jobslee0.github.io/fan-yi-groovybian-cheng-feng-ge-zhi-nan.html" class="btn previous" rel="prev" aria-label="[MISSING TRANSLATION]:  ã€ç¿»è¯‘ã€‘Groovyç¼–ç¨‹é£æ ¼æŒ‡å— "><span class="btn__icon">â†</span> <span class="btn__text">ã€ç¿»è¯‘ã€‘Groovyç¼–ç¨‹é£æ ¼æŒ‡å—</span> </a><a href="https://jobslee0.github.io/fan-yi-groovybian-cheng-feng-ge-zhi-nan.html" class="btn next" rel="next" aria-label="[MISSING TRANSLATION]:  ã€ç¿»è¯‘ã€‘Groovyç¼–ç¨‹é£æ ¼æŒ‡å— "><span class="btn__text">ã€ç¿»è¯‘ã€‘Groovyç¼–ç¨‹é£æ ¼æŒ‡å—</span> <span class="btn__icon">â†’</span></a></div></nav></article></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p>Â© 2024 Powered by Publii CMS :: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank" rel="noopener">Theme</a> ported by the <a href="https://getpublii.com/customization-service/" target="_blank" rel="noopener">Publii Team</a></p></div></div></footer></div><script defer="defer" src="https://jobslee0.github.io/assets/js/scripts.min.js?v=c2232aa7558e9517946129d2a1b8c770"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>